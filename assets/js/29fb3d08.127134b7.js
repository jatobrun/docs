"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[872],{3905:function(e,a,n){n.d(a,{Zo:function(){return p},kt:function(){return u}});var t=n(7294);function o(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function i(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function s(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?i(Object(n),!0).forEach((function(a){o(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function l(e,a){if(null==e)return{};var n,t,o=function(e,a){if(null==e)return{};var n,t,o={},i=Object.keys(e);for(t=0;t<i.length;t++)n=i[t],a.indexOf(n)>=0||(o[n]=e[n]);return o}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)n=i[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var r=t.createContext({}),d=function(e){var a=t.useContext(r),n=a;return e&&(n="function"==typeof e?e(a):s(s({},a),e)),n},p=function(e){var a=d(e.components);return t.createElement(r.Provider,{value:a},e.children)},c={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},m=t.forwardRef((function(e,a){var n=e.components,o=e.mdxType,i=e.originalType,r=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=d(n),u=o,k=m["".concat(r,".").concat(u)]||m[u]||c[u]||i;return n?t.createElement(k,s(s({ref:a},p),{},{components:n})):t.createElement(k,s({ref:a},p))}));function u(e,a){var n=arguments,o=a&&a.mdxType;if("string"==typeof e||o){var i=n.length,s=new Array(i);s[0]=m;var l={};for(var r in a)hasOwnProperty.call(a,r)&&(l[r]=a[r]);l.originalType=e,l.mdxType="string"==typeof e?e:o,s[1]=l;for(var d=2;d<i;d++)s[d]=n[d];return t.createElement.apply(null,s)}return t.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5575:function(e,a,n){n.r(a),n.d(a,{frontMatter:function(){return l},contentTitle:function(){return r},metadata:function(){return d},toc:function(){return p},default:function(){return m}});var t=n(7462),o=n(3366),i=(n(7294),n(3905)),s=["components"],l={sidebar_position:2},r="Kubernetes",d={unversionedId:"herramientas/kubernetes",id:"herramientas/kubernetes",title:"Kubernetes",description:"Es una tecnologia que permite orquestar contenedores. Podemos usar esta",source:"@site/docs/herramientas/kubernetes.md",sourceDirName:"herramientas",slug:"/herramientas/kubernetes",permalink:"/docs/herramientas/kubernetes",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/herramientas/kubernetes.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Docker",permalink:"/docs/herramientas/docker"},next:{title:"GIT",permalink:"/docs/herramientas/git"}},p=[{value:"Instalacion",id:"instalacion",children:[{value:"Kubernetes Dashboard",id:"kubernetes-dashboard",children:[],level:3}],level:2},{value:"Overview",id:"overview",children:[],level:2},{value:"Nodes",id:"nodes",children:[{value:"Control plane node (Master node)",id:"control-plane-node-master-node",children:[],level:3},{value:"Worker nodes",id:"worker-nodes",children:[],level:3}],level:2},{value:"Contextos",id:"contextos",children:[{value:"Kubeconfig",id:"kubeconfig",children:[],level:3},{value:"Manejo de contextos",id:"manejo-de-contextos",children:[],level:3},{value:"Archivos de configuracion",id:"archivos-de-configuracion",children:[],level:3}],level:2},{value:"CheatSheet (Comandos mas usados)",id:"cheatsheet-comandos-mas-usados",children:[],level:2},{value:"In-Tree vs out-of-Tree",id:"in-tree-vs-out-of-tree",children:[],level:2},{value:"Endpoints and Endpoints - slices",id:"endpoints-and-endpoints---slices",children:[],level:2},{value:"Jobs",id:"jobs",children:[],level:2},{value:"Namespace",id:"namespace",children:[{value:"Scoping",id:"scoping",children:[],level:3}],level:2},{value:"Selectors",id:"selectors",children:[{value:"label selector",id:"label-selector",children:[],level:3},{value:"Recommend Labels",id:"recommend-labels",children:[],level:3},{value:"Annotations",id:"annotations",children:[],level:3}],level:2},{value:"Kubelet",id:"kubelet",children:[{value:"gRPC",id:"grpc",children:[],level:3},{value:"Comunicacion",id:"comunicacion",children:[],level:3}],level:2},{value:"Kubectl",id:"kubectl",children:[{value:"Command",id:"command",children:[],level:3},{value:"Type",id:"type",children:[],level:3},{value:"Name",id:"name",children:[],level:3},{value:"Flags",id:"flags",children:[],level:3}],level:2},{value:"Runtimes",id:"runtimes",children:[{value:"Tipos de CRI",id:"tipos-de-cri",children:[{value:"ContainerD",id:"containerd",children:[],level:4},{value:"CRI-O",id:"cri-o",children:[],level:4}],level:3}],level:2},{value:"Storage",id:"storage",children:[{value:"Container storage interface (CSI)",id:"container-storage-interface-csi",children:[],level:3},{value:"Backing store and etcd",id:"backing-store-and-etcd",children:[],level:3},{value:"Volumes",id:"volumes",children:[{value:"PVC",id:"pvc",children:[],level:4}],level:3},{value:"Configmaps",id:"configmaps",children:[],level:3}],level:2},{value:"Pods",id:"pods",children:[{value:"Manifiestos de pods",id:"manifiestos-de-pods",children:[],level:3},{value:"Variables de Entorno",id:"variables-de-entorno",children:[],level:3},{value:"Recursos",id:"recursos",children:[{value:"Tipos de Recursos",id:"tipos-de-recursos",children:[],level:4}],level:3},{value:"Probes",id:"probes",children:[{value:"Readiness Probe",id:"readiness-probe",children:[],level:4},{value:"Liveness Probe",id:"liveness-probe",children:[],level:4},{value:"Startup Probe",id:"startup-probe",children:[],level:4},{value:"Ejemplo completo",id:"ejemplo-completo",children:[],level:4}],level:3}],level:2},{value:"Deployments",id:"deployments",children:[{value:"Replicas",id:"replicas",children:[],level:3},{value:"Manifiesto",id:"manifiesto",children:[],level:3}],level:2},{value:"DaemonSet",id:"daemonset",children:[{value:"Manifiesto",id:"manifiesto-1",children:[],level:3}],level:2},{value:"StatefullSet",id:"statefullset",children:[{value:"PVC (Persistant Volume Claim)",id:"pvc-persistant-volume-claim",children:[],level:3},{value:"Manifiesto",id:"manifiesto-2",children:[],level:3}],level:2},{value:"Networking",id:"networking",children:[{value:"Tipos de networking",id:"tipos-de-networking",children:[{value:"Contenedor a Contenedor",id:"contenedor-a-contenedor",children:[],level:4},{value:"Pod a Pod",id:"pod-a-pod",children:[],level:4},{value:"Pod a servicio",id:"pod-a-servicio",children:[],level:4},{value:"Exterior a un servicio",id:"exterior-a-un-servicio",children:[],level:4}],level:3},{value:"Servicios",id:"servicios",children:[],level:3},{value:"Traffic policies",id:"traffic-policies",children:[],level:3},{value:"Ingress",id:"ingress",children:[],level:3},{value:"DNS (Domain Name system)",id:"dns-domain-name-system",children:[],level:3}],level:2},{value:"ConfigMaps",id:"configmaps-1",children:[{value:"Manifiesto",id:"manifiesto-3",children:[],level:3}],level:2},{value:"Secrets",id:"secrets",children:[],level:2},{value:"Cloud Native",id:"cloud-native",children:[{value:"Roadmap",id:"roadmap",children:[],level:3}],level:2},{value:"Security",id:"security",children:[{value:"Cloud Layer (base layer)",id:"cloud-layer-base-layer",children:[],level:3},{value:"Cluster Layer",id:"cluster-layer",children:[],level:3},{value:"Container and Code layer",id:"container-and-code-layer",children:[],level:3}],level:2}],c={toc:p};function m(e){var a=e.components,l=(0,o.Z)(e,s);return(0,i.kt)("wrapper",(0,t.Z)({},c,l,{components:a,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"kubernetes"},"Kubernetes"),(0,i.kt)("p",null,"Es una tecnologia que permite orquestar contenedores. Podemos usar esta\n",(0,i.kt)("a",{parentName:"p",href:"https://sre.google/sre-book/table-of-contents/"},"referencia"),"."),(0,i.kt)("p",null,"Kubernetes es declarativo es decir yo creo un manifiesto donde indico cuantos\ncontenedores quiero, que contenedores quiero, etc."),(0,i.kt)("h2",{id:"instalacion"},"Instalacion"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Necesitaremos ",(0,i.kt)("inlineCode",{parentName:"p"},"kubectl")," el cual es el cliente de kubernetes. ",(0,i.kt)("inlineCode",{parentName:"p"},"Kubectl")," se conecta al cluster de Kubernetes\ny por medio de la terminal podremos manejar nuestro cluster. Podemos seguir el siguiente\n",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/es/docs/tasks/tools/install-kubectl/"},"enlace")," para instalar kubectl.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Para saber si tenemos kubectl usamos el siguiente comando:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl version --client=true\n")),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Ahora necesitamos instalar nuestro cluster, la forma mas facil de instalar un cluster de\nkubernetes es con ",(0,i.kt)("inlineCode",{parentName:"p"},"docker Desktop"),". Tambien podemos usar ",(0,i.kt)("inlineCode",{parentName:"p"},"minikube"),", para saber como instalar\npara saber como instalar ",(0,i.kt)("inlineCode",{parentName:"p"},"minikube")," podemos usar el siguiente\n",(0,i.kt)("a",{parentName:"p",href:"https://v1-19.docs.kubernetes.io/es/docs/tasks/tools/install-minikube/"},"enlace"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Luego de tener el cliente de kubernetes ",(0,i.kt)("inlineCode",{parentName:"p"},"kubectl")," y tener un cluster de kubernetes creado.\nNecesitaremos conectar ",(0,i.kt)("inlineCode",{parentName:"p"},"kubectl")," a dicho cluster por medio de un archivo de configuracion llamado\n",(0,i.kt)("inlineCode",{parentName:"p"},"kube.config")))),(0,i.kt)("h3",{id:"kubernetes-dashboard"},"Kubernetes Dashboard"),(0,i.kt)("p",null,"Es una forma de poder manejar tu cluster por medio de una ui. Para mas ",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/"},"informacion")),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Clusters: una agrupacion logica de todos los recursos")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Namespace: una agrupacion logica por nombre de los recursos que hay en un cluster.\nNormalmente se usa para aislar diferentes workloads dentro del cluster")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Node: La maquina virtual donde se ejecutan los pods. Existen 2 tipos de nodos\n",(0,i.kt)("inlineCode",{parentName:"p"},"worker nodes")," y ",(0,i.kt)("inlineCode",{parentName:"p"},"control nodes")," los primeros es donde las aplicaciones corren mientras que\nel segundo maneja los ",(0,i.kt)("inlineCode",{parentName:"p"},"worker nodes"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Pod: es la unidad mas peque\xf1a en k8s. Es la forma de abstraer un contenedor")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Services: Es una ip estatica o un dns para un grupo de pods (la ip persiste incluso si el pod muere)")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Ingress: Traduce reglas http/s que apuntan servicios")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Api Server: Es columna de las comunicaciones en kubernetes")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Kubelet: Permite comunicarnos con los nodos desde kubectl")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Kubectl: El CLI que ayuda a los usuarios a interactuar con el cluster y sus servicios atraves\ndel api server")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Cloud controller manager: Habilita el link con CSP (Aws, azure, gcp)")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Controller manager: Es el cerebro de kubernetes")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Scheduler: Sabe donde ubicar los pods y los ubica en una cola")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Etcd: almacena el estado del cluster como una base de datos o un .tfstate file")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Kube Proxy: Se encarga de todo el networking dentro de los pods (routing and filtering) rules")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Network policies: Es un firewall virtual que restringe la comunicacion")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Config maps: Tener configuraciones especificas como un mini data store")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Secrets: es un configmap pero encriptada")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"volumes: son los discos duros")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Statefullset: Indica la existencia unica de cada pod")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"replicaset: Mantiene la cantidad de pods que se solicita")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Deployment: es un template de lo que se quiere deployar."))),(0,i.kt)("h2",{id:"nodes"},"Nodes"),(0,i.kt)("h3",{id:"control-plane-node-master-node"},"Control plane node (Master node)"),(0,i.kt)("p",null,"Realizan tareas como programar, reiniciar nodos, control, etc."),(0,i.kt)("p",null,"Los principales elementos dentro de este tipo de nodos son:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Api server"),(0,i.kt)("li",{parentName:"ol"},"Scheduler"),(0,i.kt)("li",{parentName:"ol"},"Control manager"),(0,i.kt)("li",{parentName:"ol"},"Etcd"),(0,i.kt)("li",{parentName:"ol"},"kubelet")),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Esto normalmente esta dentro del namespace ",(0,i.kt)("inlineCode",{parentName:"p"},"kubesystem")))),(0,i.kt)("h3",{id:"worker-nodes"},"Worker nodes"),(0,i.kt)("p",null,"Se encarga de ejecutar las apps y tenemos los siguientes elemento dentro de estos:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Api server"),(0,i.kt)("li",{parentName:"ol"},"kubelet"),(0,i.kt)("li",{parentName:"ol"},"Kube Proxy"),(0,i.kt)("li",{parentName:"ol"},"Container runtime"),(0,i.kt)("li",{parentName:"ol"},"iptables"),(0,i.kt)("li",{parentName:"ol"},"pods and containers")),(0,i.kt)("h2",{id:"contextos"},"Contextos"),(0,i.kt)("p",null,"Los contextos son la combinacion entre usuarios y cluster. Dice que usuario usa que cluster."),(0,i.kt)("h3",{id:"kubeconfig"},"Kubeconfig"),(0,i.kt)("p",null,"Son los archivos que tienen configurado los cluster, los usuarios y los contextos que tenemos en nuestra maquina\npara controlar los cluster de kubernetes. Estos archivos de configuracion nos permite conectarnos a nuestros\nclusters de kubernetes sin tener que estar configurando el servidor, usuario, configuracion, etc."),(0,i.kt)("p",null,"Estos archivos tienen 3 partes: ",(0,i.kt)("inlineCode",{parentName:"p"},"users"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"clusters")," y ",(0,i.kt)("inlineCode",{parentName:"p"},"contexts")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{5-7,9-13,15-19}","{5-7,9-13,15-19}":!0},"apiVersion: 1\nkind: Config\npreferences: {}\n\nusers:\n    - name: docker-desktop\n    - name: minikube\n\nclusters:\n    - cluster:\n      name: docker-desktop\n    - cluster:\n      name: minikube\n\ncontexts:\n    - context:\n      name: docker-desktop\n    - context:\n      name: minikube\n\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Los usuarios necesitaran un ",(0,i.kt)("inlineCode",{parentName:"li"},"certificado")," y una ",(0,i.kt)("inlineCode",{parentName:"li"},"llave"),"."),(0,i.kt)("li",{parentName:"ul"},"Los clusters necesitara un ",(0,i.kt)("inlineCode",{parentName:"li"},"CA")," y una ",(0,i.kt)("inlineCode",{parentName:"li"},"ip"),"."),(0,i.kt)("li",{parentName:"ul"},"Los contextos usaran un ",(0,i.kt)("inlineCode",{parentName:"li"},"usuario")," y un ",(0,i.kt)("inlineCode",{parentName:"li"},"cluster"),".")),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Puedes dar el valor del certificado en base64 quemado o puedes poner la ruta del archivo"))),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"El archivo kubeconfig lo podemos encontrar en la ruta ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.kube/")," puedes usar nano para abrirlo\n",(0,i.kt)("inlineCode",{parentName:"p"},"nano ~/.kube/config")," o usar el comando ",(0,i.kt)("inlineCode",{parentName:"p"},"kubectl config view")))),(0,i.kt)("h3",{id:"manejo-de-contextos"},"Manejo de contextos"),(0,i.kt)("p",null,"Para ver los nodos de un contexto usas el siguiente comando"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl --context=${CONTEXT} get nodes\n")),(0,i.kt)("p",null,"Puedes usar ",(0,i.kt)("inlineCode",{parentName:"p"},"kubeselect")," para que puedas ver todos los contextos que tienes y seleccionar\nen cual quieres trabajar con esto te evitas el ",(0,i.kt)("inlineCode",{parentName:"p"},"--context"),". Para su instalacion usa el siguiente\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/fatliverfreddy/kubeselect"},"link"),"."),(0,i.kt)("h3",{id:"archivos-de-configuracion"},"Archivos de configuracion"),(0,i.kt)("p",null,"Si posees un kubeconfig para tu cluster lo puedes usar de las siguientes formas:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Sin variable de entorno")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl --kubeconfig=${PATH_TO_KUBECONFIG_FILE} get nodes\n")),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"Con variable de entorno")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"export KUBECONFIG=${PATH_TO_KUBECONFIG_FILE}\nkubectl get nodes\n")),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},"Varios archivos de configuracion pero no quiero juntarlos")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"export KUBECONFIG=${PATH_TO_KUBECONFIG_FILE}:${PATH_TO_OTHER_KUBECONFIG_FILE}\nkubectl --context=${CONTEXT_NAME} get nodes\n")),(0,i.kt)("ol",{start:4},(0,i.kt)("li",{parentName:"ol"},"Si queremos hacer un merge de todos los archivos que tenemos de configuracion")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"export KUBECONFIG=${PATH_TO_KUBECONFIG_FILE}:${PATH_TO_OTHER_KUBECONFIG_FILE}\nkubectl config view --merge --flatten > config.yaml\n")),(0,i.kt)("ol",{start:5},(0,i.kt)("li",{parentName:"ol"},"Si queremos extraer un contexto de un archivo con configuraciones")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"export KUBECONFIG=config.yaml\nkubectl config view --minify \\\n--flatten \\\n--context=${CONTEXT_NAME} \\\n> ${CONTEXT_NAME}.yaml\n")),(0,i.kt)("h2",{id:"cheatsheet-comandos-mas-usados"},"CheatSheet (Comandos mas usados)"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"kubectl get")," Sirve para obtener recursos."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"kubectl edit")," Sirve para editar un recurso."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"kubectl delete")," Borrar un recurso."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"kubectl apply")," Aplicar manifiestos en el cluster."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"kubectl exec")," Aplicar comandos a un contenedor."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Kubectl logs")," Ver los logs de un pod o contenedor."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"kubectl cp")," Copiar archivos desde nuestro pc al contenedor."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"kubectl port-forward")," Para forwardear un puerto que un contenedor este exponiendo."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"kubectl drain")," Vamos sacar todos los contenedores de un nodo."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"kubectl cordon")," Hacer que ese nodo ya no reciba mas contenedores."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"kubectl uncordon")," lo contrario a cordon."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"kubect config get-contexts")," Para ver todos los contextos del archivo kubeconfig."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"kubectl config use-context")," Para setear un contexto, puedes revisar el manejo de contextos\n",(0,i.kt)("a",{parentName:"li",href:"#manejo-de-contextos"},"aqui"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"kubectl describe")," Para ver los eventos de los pods.")),(0,i.kt)("p",null,"Kubernetes tiene la opcion de usar abreviaciones podemos verlas\n",(0,i.kt)("a",{parentName:"p",href:"https://blog.heptio.com/kubectl-resource-short-names-heptioprotip-c8eff9fb7202"},"aqui"),"."),(0,i.kt)("h2",{id:"in-tree-vs-out-of-tree"},"In-Tree vs out-of-Tree"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"In-Tree\nSon los plugins que ya vienen por default dentro del proyecto o que estan en el mismo\ndirectorio"),(0,i.kt)("li",{parentName:"ul"},"Out-of-tree\nSon los plugins que de forma manual debemos instalar para extender las capacidades\nde la herramienta que estamos usando")),(0,i.kt)("h2",{id:"endpoints-and-endpoints---slices"},"Endpoints and Endpoints - slices"),(0,i.kt)("p",null,"Trackean la ip de los pods asignados a un services de kubernetes\nCuando un selector de un servicio hace match con una label de un pod la ip del pod\nentra al pool de endopints con el fin de que el servicio sepa a cuales direciones ip debe mandar\nel trafico. Recordemos que esto es asi porque los pods mueren constantemente entonces sus ips\ncambian los servicios por otro lado son estaticos y para mapear la ip de los pods existe esta pool\nde endpoints. Por ende los pods se exponen publicamente hacia los servicios usando los endpoints."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get endpoints # obtenemos la lista de endpoints\n")),(0,i.kt)("p",null,"Por otro lado los ",(0,i.kt)("inlineCode",{parentName:"p"},"endpoints slices")," son segmentos que manejan hasta un limite de 100 pods."),(0,i.kt)("h2",{id:"jobs"},"Jobs"),(0,i.kt)("p",null,"UN background job es una forma de ejecutar una tarea que realiza una tarea en especifico se usa\nbastante cuando queremos hacer backups a las bases de datos."),(0,i.kt)("p",null,"En kubernetes tenemos algo similar los ",(0,i.kt)("inlineCode",{parentName:"p"},"cronjobs")," y los ",(0,i.kt)("inlineCode",{parentName:"p"},"jobs")),(0,i.kt)("p",null,"Los ",(0,i.kt)("inlineCode",{parentName:"p"},"jobs")," es un grupo de pods que ejecutaran una accion de manera indefinida hasta que la accion\nse termine"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl create job hello --image busy-box -- echo "hello world"\n')),(0,i.kt)("p",null,"los ",(0,i.kt)("inlineCode",{parentName:"p"},"cronjobs")," usan cron expresions para definir el tiempo. Y son basicamente jobs pero que se\ndisparan con eventos de tiempo, es decir, cada 5 segundos o cada 1 dia."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl create job hello --image busy-box --schedule "*/1 * * * *" -- echo "Hello world"\n')),(0,i.kt)("h2",{id:"namespace"},"Namespace"),(0,i.kt)("p",null,"Es una division logica de tu cluster de kubernetes, permite separar la carga del cluster."),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Por default los datos dentro de los ns si se pueden ver entre ellos"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get ns\n")),(0,i.kt)("p",null,"Kubernetes empieza con 4 namespaces:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"default")," aqui se agregan todos los pods a los que no le agregamos namespace"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"kube-public")," para recursos que queremos que sean publicos"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"kube-system")," almacena todos los pods creados por el systema de kubernetes"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"kube-node-lease")," Se usa para detectar fallas en los nodos como (un healthcheck para nodos)")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"El nombre de los pods dentro del namespace debe ser unico pero fuera de el puede repetirse"),(0,i.kt)("li",{parentName:"ul"},"Podemos aplicar una restricion de quota por namespace para tener un control de la memoria o cpu\nque usan los pods dentro de ese namespace")),(0,i.kt)("h3",{id:"scoping"},"Scoping"),(0,i.kt)("p",null,"Dentro de kubernetes existe algo parecido a los lenguajes de programacion como es el scope"),(0,i.kt)("p",null,"tenemos 3 tipos de scope:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Single namespace object: Solo pueden existir dentro del namespace (secrets and configmaps)"),(0,i.kt)("li",{parentName:"ol"},"Multi namespace object: Pueden existir entre varios namespace (pods and service)"),(0,i.kt)("li",{parentName:"ol"},"Cluster-wide objets: Recursos globales (nodos y volumenes)")),(0,i.kt)("h2",{id:"selectors"},"Selectors"),(0,i.kt)("p",null,"Es una forma para seleccionar varios recursos dentro de kubernetes.\nExisten 3 tipos de selectores:"),(0,i.kt)("h3",{id:"label-selector"},"label selector"),(0,i.kt)("p",null,"Selecciona los recursos de k8s usando su label. Los labels son de ",(0,i.kt)("inlineCode",{parentName:"p"},"key:value")," y estos se encuentran\nen la metadata del manifiesto."),(0,i.kt)("p",null,"Ejemplo"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{6-7}","{6-7}":!0},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\n  labels: \n    env: prod\n    app: nginx-web\n")),(0,i.kt)("p",null,"Para poder ver las labels de los pods podemos usar"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pods --show-labels\n")),(0,i.kt)("p",null,"Tambien podemos agregar labels por medio de ",(0,i.kt)("inlineCode",{parentName:"p"},"kubectl")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl label pods nginx env=dev\n")),(0,i.kt)("h3",{id:"recommend-labels"},"Recommend Labels"),(0,i.kt)("p",null,"Son labels que se deberian usar en cada recurso"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"app.kubernetes.io/name"),(0,i.kt)("li",{parentName:"ul"},"app.kubernetes.io/instance"),(0,i.kt)("li",{parentName:"ul"},"app.kubernetes.io/version"),(0,i.kt)("li",{parentName:"ul"},"app.kubernetes.io/component"),(0,i.kt)("li",{parentName:"ul"},"app.kubernetes.io/part-of"),(0,i.kt)("li",{parentName:"ul"},"app.kubernetes.io/managed-by"),(0,i.kt)("li",{parentName:"ul"},"app.kubernetes.io/created-by")),(0,i.kt)("p",null,"Labels sin el prefix ",(0,i.kt)("inlineCode",{parentName:"p"},"app.kubernetes.io/")," son privadas para los usuarios"),(0,i.kt)("p",null,"Ejemplo:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Pod\nmetadata:\n  labels: \n    app.kubernetes.io/name: mysql\n    app.kubernetes.io/instance: mysql-abxc\n    app.kubernetes.io/version: 5.7.2\n    app.kubernetes.io/component: database\n    app.kubernetes.io/part-of: wordpress\n    app.kubernetes.io/managed-by: helm\n    app.kubernetes.io/created-by: controller-manager\n")),(0,i.kt)("p",null,"Para matchear las labels selector con diferentes servicios o replicas set debemos\nrecurrir a la documentacion debido a que cada recurso en kubernetes tiene una forma\ndistinta de matchear los label por ejemplo en servicios se usa la palabra ",(0,i.kt)("inlineCode",{parentName:"p"},"selector"),"\npero en replicaset se usa ",(0,i.kt)("inlineCode",{parentName:"p"},"matchLabels"),"."),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"field selector")," Selecciona los recusos usando la metadata"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"node selector")," Selecciona nodos para pods")),(0,i.kt)("h3",{id:"annotations"},"Annotations"),(0,i.kt)("p",null,"Nos ayuda a agrerar metada de terceros con el fin de extender sus funcionalidades"),(0,i.kt)("p",null,"Ejemplo"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Ingress\nmetadata:\n  name: minimal-ingress\n  annotations: \n    nginx.ingress.kubernetes.io/rewrite-target: /\n")),(0,i.kt)("p",null,"Con ese ejemplo lo que hacemos es usar un controlador nginx para las reglas de trafico"),(0,i.kt)("h2",{id:"kubelet"},"Kubelet"),(0,i.kt)("p",null,"Es el agente responsable de la comunicacion entre los pods y el API server."),(0,i.kt)("p",null,"Un Agente es el encargado de observar que le ocurre a los programas y comunicar\nla informacion a los exteriores o tomar acciones."),(0,i.kt)("p",null,"Kubelet es el encargado de:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Observar los cambios de un pod"),(0,i.kt)("li",{parentName:"ul"},"Configurar el container runtime para crear namespaces, descargar imagenes o ejecutar contenedores"),(0,i.kt)("li",{parentName:"ul"},"Kubelet usa el ",(0,i.kt)("inlineCode",{parentName:"li"},"PodSpec file")," para saber que contenedores y recursos debe usar.")),(0,i.kt)("h3",{id:"grpc"},"gRPC"),(0,i.kt)("p",null,"Es un protocolo de comunicacion como (Rest o graphql). El cual nos permite comunicarnos entre\nprogramas con diferentes lenguajes de programacion. Normalmente los encontramos en sistemas distribuidos\no microservicios."),(0,i.kt)("h3",{id:"comunicacion"},"Comunicacion"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"kubelet-comunication",src:n(7280).Z})),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Kubelet esta monitoreando constantemente los cambios de los pods"),(0,i.kt)("li",{parentName:"ol"},"Kubelet envia peticiones HTTPS al Api server"),(0,i.kt)("li",{parentName:"ol"},"Kubelet interactua con el storage por medio de CSI (container storage interface) usando\ngRPC"),(0,i.kt)("li",{parentName:"ol"},"Kubelet interactura con el CRI (container runtime interface) usando gRPC"),(0,i.kt)("li",{parentName:"ol"},"El CRI se comunica con el CNI (container network interface) por su cuenta")),(0,i.kt)("h2",{id:"kubectl"},"Kubectl"),(0,i.kt)("p",null,"Es el CLI (command line interface) que nos permite controlar nuestros clusters\nde kubernetes. Esto lo hace enviando Peticiones HTTPS al api server."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Kubectl usa un archivo de configuraciones el cual se encuentra en ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.kube")))),(0,i.kt)("p",null,"Kubectl tiene la siguiente syntaxis"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"kubectl ","[command][type]"," ","[name][flags]")),(0,i.kt)("h3",{id:"command"},"Command"),(0,i.kt)("p",null,"Es la operacion que queremos realizar"),(0,i.kt)("p",null,"Commandos:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"annotation: informacion de tipo ",(0,i.kt)("inlineCode",{parentName:"li"},"key:value")," que podemos agregar a los recursos"),(0,i.kt)("li",{parentName:"ul"},"apply*: para ejecuta manifiestos con los que podemos crear o modificar recursos"),(0,i.kt)("li",{parentName:"ul"},"auth: Revisa si tienes la autorizacion para ejecutar una accion"),(0,i.kt)("li",{parentName:"ul"},"autoscale: Crea un autoescalador que automaticamente modifica el numero de pods"),(0,i.kt)("li",{parentName:"ul"},"cp: Copia archivos y directorio a los contenedores o desde los contenedores"),(0,i.kt)("li",{parentName:"ul"},"create: Crear los recursos en un manifiesto (no puede modificar, por ende, casi siempre usaremos apply)"),(0,i.kt)("li",{parentName:"ul"},"delete: Eliminar recursos"),(0,i.kt)("li",{parentName:"ul"},"describe: Muestra detalles de los recursos"),(0,i.kt)("li",{parentName:"ul"},"diff: diff la configuracion local contra la remota"),(0,i.kt)("li",{parentName:"ul"},"edit: Edita el manifiesto de un recurso"),(0,i.kt)("li",{parentName:"ul"},"exec*: ejecuta un comando dentro del contenedor"),(0,i.kt)("li",{parentName:"ul"},"expose*: Expone un pod por medio de un servicio"),(0,i.kt)("li",{parentName:"ul"},"get*: Obtiene la informacion de un recurso en menos detalle que ",(0,i.kt)("inlineCode",{parentName:"li"},"describe")),(0,i.kt)("li",{parentName:"ul"},"kustomize: Hace un merge de manifiesto declarados en un ",(0,i.kt)("inlineCode",{parentName:"li"},"kustomize.yaml")),(0,i.kt)("li",{parentName:"ul"},"label: actualiza labels en los recursos"),(0,i.kt)("li",{parentName:"ul"},"logs*: Print los logs de un recurso, contenedor o pod"),(0,i.kt)("li",{parentName:"ul"},"patch: Actualiza los campos de un recurso usando strategic merge patch, JSON merge patch o JSON patch"),(0,i.kt)("li",{parentName:"ul"},"port-forward: Forward un o mas puertos loales a un pod"),(0,i.kt)("li",{parentName:"ul"},"proxy: Create un servidor proxy entre el localhost y el API server"),(0,i.kt)("li",{parentName:"ul"},"run: Corre imagenes de contenedores en pods"),(0,i.kt)("li",{parentName:"ul"},"scale: Cambia el tama\xf1o de los pods, es decir, crea mas instancias.")),(0,i.kt)("h3",{id:"type"},"Type"),(0,i.kt)("p",null,"Se refiere al tipo de recurso\nHay mas de 50 tipos de recursos en Kubernetes algunos tienes abreviaciones no todos para mas informacion\npodemos ",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/kubectl/#:~:text=Valid%20resource%20types%20include%3A%20deployments%2C%20daemonsets%20and%20statefulsets.&text=Run%20a%20specified%20image%20on%20the%20cluster.&text=Update%20the%20size%20of%20the%20specified%20replication%20controller.&text=Configure%20application%20resources."},"visitar")),(0,i.kt)("h3",{id:"name"},"Name"),(0,i.kt)("p",null,"Especifica el nombre del recursos, podemos usar mas de un nombre de un recurso separados por espacios\nademas sino indicamos el nombre nos mostrara todos."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pods nginx-server1 nginx-server2\n")),(0,i.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Los nombres son case-sensitive"))),(0,i.kt)("h3",{id:"flags"},"Flags"),(0,i.kt)("p",null,"Son las flags que podemos pasar a los comandos, similar a las flags que pasamos a los comandos en linux.\nUsamos ",(0,i.kt)("inlineCode",{parentName:"p"},"--")," seguido del nombre de la flag y el valor de la flag puede llevar ",(0,i.kt)("inlineCode",{parentName:"p"},"=")," como un ",(0,i.kt)("inlineCode",{parentName:"p"},"usar espacio\no igual es un poco random depende de cada uno. Hay alguno CLI que si son sensibles al usar `=` o")," pero\nkubectl no"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"para las abreviaciones usamos solo ",(0,i.kt)("inlineCode",{parentName:"li"},"-")),(0,i.kt)("li",{parentName:"ul"},"las flags van a depender del comando que usemos"),(0,i.kt)("li",{parentName:"ul"},"No en todos los casos se debe pasar informacion a los flags")),(0,i.kt)("p",null,"Podemos encontrar documentacion sobre kubectl en el siguiente ",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands"},"link")),(0,i.kt)("h2",{id:"runtimes"},"Runtimes"),(0,i.kt)("p",null,"Docker y Kubernetes no son CRI(container runtime interface) sino que son orquestadores\nellos usan CRI como ",(0,i.kt)("inlineCode",{parentName:"p"},"containerd")," o ",(0,i.kt)("inlineCode",{parentName:"p"},"CRI-O")," los que a su vez usan Container runtimes como\n",(0,i.kt)("inlineCode",{parentName:"p"},"runC")," o ",(0,i.kt)("inlineCode",{parentName:"p"},"Crun"),"."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Orchestadores: Buildean imagenes, manejan servicios, networking, etc"),(0,i.kt)("li",{parentName:"ul"},"CRI: push/pull imagenes, supervisan contenedores, maneja el storage y el networking"),(0,i.kt)("li",{parentName:"ul"},"OCI (Open container iniciative): Corren los contenedores.",(0,i.kt)("div",{parentName:"li",className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Existen dos tipos de OCI nativos y virtualizados. La principal diferencia es la ",(0,i.kt)("inlineCode",{parentName:"p"},"isolation"),".\nLos virtualizados pueden dar mas seguridad por medio de la ",(0,i.kt)("inlineCode",{parentName:"p"},"isolation")))))),(0,i.kt)("h3",{id:"tipos-de-cri"},"Tipos de CRI"),(0,i.kt)("h4",{id:"containerd"},"ContainerD"),(0,i.kt)("p",null,"Es uno de los estandares de la industria. Buscan simplicidad, portabilidad y robustez.\nDocker extrajo su CRI, lo convirtio en un proyecto llamado ",(0,i.kt)("inlineCode",{parentName:"p"},"containerd")," y entro a la CNCF."),(0,i.kt)("p",null,"La images que buildeamos con docker no son docker images sino que ya forman parte de un estandar"),(0,i.kt)("h4",{id:"cri-o"},"CRI-O"),(0,i.kt)("p",null,"Es una buena alternativa a containerd, es el CRI que usa Kubernetes y tiene habilitado el\nOCI. Esto habilita a que kubernetes pueda usar cualquier Container runtime como runc o Crun."),(0,i.kt)("h2",{id:"storage"},"Storage"),(0,i.kt)("h3",{id:"container-storage-interface-csi"},"Container storage interface (CSI)"),(0,i.kt)("p",null,"Son el intermediario entre los container orchestatrion systems(COS) y los Storage providers (SP)\ncon el fin de que se puedan comunicar de una forma estandarizada"),(0,i.kt)("p",null,"Algunos COS pueden ser:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Docker swarm"),(0,i.kt)("li",{parentName:"ul"},"Kubernetes"),(0,i.kt)("li",{parentName:"ul"},"Mesos")),(0,i.kt)("p",null,"Algunos SP:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"google cloud storage"),(0,i.kt)("li",{parentName:"ul"},"aws ebs"),(0,i.kt)("li",{parentName:"ul"},"azure disk",(0,i.kt)("div",{parentName:"li",className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Esto lo usamos cuando usamos persistent volumes"))))),(0,i.kt)("h3",{id:"backing-store-and-etcd"},"Backing store and etcd"),(0,i.kt)("p",null,"Los componentes dentro de kubernetes necesitan una forma de protegerse en caso de desastres\nestos pueden ser (el servidor se murio, se fue la luz, etc.). Entonces kubernetes usa etcd que\nseria como la base de datos para almacenar estados de los recursos, mientras los datos de aplicacion\nlos guardamos en persistent volumes."),(0,i.kt)("p",null,"Etcd: es una base de datos consistente y distribuida de tipo ",(0,i.kt)("inlineCode",{parentName:"p"},"key:value")," la cual trabaja muy bien\ncon sistemas distribuidos o clusters. Otros proyectos ademas de kubernetes lo usan como CoreDNS y Rook"),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Podemos reemplazar ",(0,i.kt)("inlineCode",{parentName:"p"},"etcd")," por una base de datos relacional como mariadb\nMinio - es un storage de tipo objetos como s3 o cloud storage\nRook - es un sistema distribuido de storage automatiza todos los task de los storage administrators"))),(0,i.kt)("h3",{id:"volumes"},"Volumes"),(0,i.kt)("p",null,"En kubernetes tenemos varios tipos de volumes:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Persistant Volume: es cuando vinculamos un disco duro a un pod. La informacion seguira existiendo\nincluso, si el pod muere")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Ephimeral Volume: Volumes que existen con el pod, es decir, si el pod muere el disco se elimina tambien\nse usa para almacenar informacion temporal")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Projected Volumes: Mapea diferentes discos duro en una sola ruta")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Volume Snapshot: Lo usamos como backups o rollbacks"))),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"A los pods podemos agregar cualquier tipo de volumen y cualquier cantidad."))),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Kubernetes no te permite asociar un PV con un pod directamente debido a como se dise\xf1o kubernetes\nademas para eso kubernetes tiene un recurso llamado PVC (persist volume claim)"))),(0,i.kt)("h4",{id:"pvc"},"PVC"),(0,i.kt)("p",null,"Lo usamos para desacoplar los pods con los persiste volumes. Basicamente lo que hace el PVC es\nhacer una peticion por un PV que cumpla ciertos criterios (tipo de almacenamiento, espacio, etc).\nSi existe un PV que cumple dichas caracteristicas se hace un match y un bind"),(0,i.kt)("h3",{id:"configmaps"},"Configmaps"),(0,i.kt)("h2",{id:"pods"},"Pods"),(0,i.kt)("p",null,"Es un set de contenedores, este set puede tener uno o varios contenedores pero normalmente\nun pod contiene un contenedor."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"El ",(0,i.kt)("inlineCode",{parentName:"p"},"hash")," que tiene cada uno de los pods es generado por el template de deployment"))),(0,i.kt)("p",null,"Podemos usar ",(0,i.kt)("inlineCode",{parentName:"p"},"kubectl get pods")," para obtener los pods, ademas podemos usar ",(0,i.kt)("inlineCode",{parentName:"p"},"kubectl get pods -o wide"),"\npara tener una informacion mas detallada sobre los pods."),(0,i.kt)("h3",{id:"manifiestos-de-pods"},"Manifiestos de pods"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{2}","{2}":!0},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nspec:\n  containers:\n  - name: nginx\n    image: nginx:alpine\n")),(0,i.kt)("p",null,"La seccion de ",(0,i.kt)("inlineCode",{parentName:"p"},"metadata")," es donde pondremos el nombre del pod y algunas etiquetas\nque nos seran utiles a la hora de manejar recursos."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"PodSpec File")," basicamente es la seccion de configuracion\nque describe a un pod, empieza con ",(0,i.kt)("inlineCode",{parentName:"p"},"spec:")),(0,i.kt)("p",null,"Para aplicar el manifiesto del pod usamos el siguiente comando:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f ${PAT_TO_THE_FILE}\n")),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("ul",{parentName:"div"},(0,i.kt)("li",{parentName:"ul"},"Sino agregamos un ns en el manifiesto, lo creara en el ns que estemos ubicados actualmente."),(0,i.kt)("li",{parentName:"ul"},"Nunca deberiamos deployar pods con ",(0,i.kt)("inlineCode",{parentName:"li"},"kubectl apply")," es la manera manual siempre\ndeberiamos deployar pods con ",(0,i.kt)("inlineCode",{parentName:"li"},"deployments")," o ",(0,i.kt)("inlineCode",{parentName:"li"},"jobs"))))),(0,i.kt)("p",null,"Para poder correr un comando en el pod podemos usar el siguiente comando."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker exec -it ${POD} -- sh\n")),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"no se necesita tener activado en el firewall del nodo ",(0,i.kt)("inlineCode",{parentName:"p"},"ssh"),", porque cuando me conecto a un pod usando\n",(0,i.kt)("inlineCode",{parentName:"p"},"docker exec -it ${POD} -- sh")," estoy usando el api de kubernetes"))),(0,i.kt)("h3",{id:"variables-de-entorno"},"Variables de Entorno"),(0,i.kt)("p",null,"Por el momento existen dos formas para manejar tus variables de entorno dentro de kubernetes:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Quemar los valores de las variables de entorno")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"title='pod.yaml' {9-17}",title:"'pod.yaml'","{9-17}":!0},'apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nspec:\n  containers:\n  - name: nginx\n    image: nginx:alpine\n    env:\n    - name: MI_VARIABLE\n      value: "pelado"\n    - name: MI_OTRA_VARIABLE\n      value: "pelade"\n    - name: DD_AGENT_HOST\n      valueFrom:\n        fieldRef:\n          fieldPath: status.hostIP\n')),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"el ",(0,i.kt)("inlineCode",{parentName:"p"},"status.hostIP")," es un valor que lo saca del ",(0,i.kt)("inlineCode",{parentName:"p"},"downward api")," de kubernetes tiene algunos otros valores utiles,\nque podemos utilizar para mas ",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/"},"informacion"),"."))),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"Utilizar un manifiesto tipo secret para mas informacion ir a la seccion ",(0,i.kt)("a",{parentName:"li",href:"#secrets"},"secrets"),".")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"title='secrets.yaml' {4-5,7}",title:"'secrets.yaml'","{4-5,7}":!0},"apiVersion: v1\nkind: Secret\nmetadata:\n  name: misecreto\ntype: Opaque\ndata:\n  password: PasswordSecreta # Puede estar en base64 \n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"title='pod.yaml' {14-18}",title:"'pod.yaml'","{14-18}":!0},'apiVersion: v1\nkind: Pod\nmetadata:\n  name: envar-demo\n  labels:\n    purpose: demonstrate-envars\nspec:\n  containers:\n  - name: envar-demo-container\n    image: gcr.io/google-samples/node-hello:1.0\n    env:\n    - name: ENV1\n      value: "Esta es una variable comun"\n    - name: ENV2\n      valueFrom:\n        secretKeyRef:\n          name: misecreto\n          key: password\n')),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Con esto conseguimos que el secret este dentro del ns y que todas las cargas puedan acceder\na estas variables de entornos."))),(0,i.kt)("h3",{id:"recursos"},"Recursos"),(0,i.kt)("p",null,"Es una forma de asignarle recursos a nuestros contenedores, los recursos se asignan por contenedor\nno por pod. Por ende podemos tener dos contenedores cada uno con sus recursos y a la final los\nrecursos del pod seria la suma de los recursos de cada contenedor mas lo que necesita el pod para\nfuncionar."),(0,i.kt)("h4",{id:"tipos-de-recursos"},"Tipos de Recursos"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"Request"),": Son los recursos que le vamos a garantizar al pod que va a tener (Por mas que no los\nuse).")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"Limits"),": Es el limite que el pod puede usar no puede usar mas de eso."))),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Aunque tengas una instancia de 1 core no necesariamente tienes disponible 1 core debido a que hay\nprocesos de kubernetes corriendo en el cluster aunque no tengas ningun ",(0,i.kt)("inlineCode",{parentName:"p"},"pod")," corriendo. Por ende\naunque tengas 1 core no necesariamente podras correr 5 pods de 100 mili cores."))),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Si un pod empieza a utilizar mas ",(0,i.kt)("inlineCode",{parentName:"p"},"recursos")," que los que estan puesto en el limite, el kernel de linux\nprocedera a matar el proceso, se va a restartear el pod."),(0,i.kt)("p",{parentName:"div"},"Esto no pasa en el cpu debido a que nunca se va a pasar del limite que tenemos. Por ende el kernel\nnunca lo va a matar, lo que pasa es que si el pod quiere usar mas cpu del limite permitido, lo que\nhara el kernel es ",(0,i.kt)("inlineCode",{parentName:"p"},"cpu throttling"),", es decir, lo va a ahorcar hasta que el pod use esa velocidad."))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nspec:\n  containers:\n  - name: nginx\n    image: nginx:alpine\n    resources:\n      requests:\n        memory: "64Mi"\n        cpu: "200m"\n      limits:\n        memory: "128Mi"\n        cpu: "500m"\n')),(0,i.kt)("h3",{id:"probes"},"Probes"),(0,i.kt)("p",null,"Los probes nos ayudan para detectar el estado del contenedor existe 3 tipos de probes"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"readiness probe"),(0,i.kt)("li",{parentName:"ul"},"liveness probe"),(0,i.kt)("li",{parentName:"ul"},"startup probe")),(0,i.kt)("h4",{id:"readiness-probe"},"Readiness Probe"),(0,i.kt)("p",null,"es una forma de explicarle a kubernetes que el pod esta listo ",(0,i.kt)("strong",{parentName:"p"},"para recibir trafico"),"."),(0,i.kt)("p",null,"Lo que hace kubernetes es hacer un get a la ruta designada y esperar un 200. En caso\nde norecibir un 200 el pod no se encuentra Ready."),(0,i.kt)("h4",{id:"liveness-probe"},"Liveness Probe"),(0,i.kt)("p",null,"Le dice cuando reiniciar un contenedor."),(0,i.kt)("p",null,"es una forma de explicarle a kubernetes que el pod esta vivo, es decir, que no\nquiero que lo mate o haga un restart."),(0,i.kt)("p",null,"Lo que hace kubernetes es chequear que el puerto 80 este abierto."),(0,i.kt)("p",null,"Hay 3 tipos de pruebas de ",(0,i.kt)("inlineCode",{parentName:"p"},"liveness")," y ",(0,i.kt)("inlineCode",{parentName:"p"},"readiness"),":"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Comando si me retorna el comando ",(0,i.kt)("inlineCode",{parentName:"li"},"0")," el contenedor es considerado vivo, caso contrario\nfalla la prueba por ende esta muerto y procede a reiniciar el contenedor.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"livenessProbe:\n      exec:\n        command:\n        - cat\n        - /tmp/healthy\n      initialDelaySeconds: 5\n      periodSeconds: 5\n")),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"Por una peticion get, si devuelve la ruta un codigo mayor o igual a 200 y menor a 400 esta vivo,\ncaso contrario la prueba falla y porcede a reiniciar el pod")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"livenessProbe:\n      httpGet:\n        path: /healthz\n        port: 8080\n        httpHeaders:\n        - name: Custom-Header\n          value: Awesome\n      initialDelaySeconds: 3\n      periodSeconds: 3\n")),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},"Por ultimo tenemos la peticion TCP, si se puede establecer conexion en el puerto el contenedor\nes considerado vivo, caso contrario la prueba falla y procede a reiniciar el pod.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"livenessProbe:\n      tcpSocket:\n        port: 8080\n      initialDelaySeconds: 15\n      periodSeconds: 20\n")),(0,i.kt)("h4",{id:"startup-probe"},"Startup Probe"),(0,i.kt)("p",null,"es una forma de saber cuando el contenedor ya inicio, esto desabilita al ",(0,i.kt)("inlineCode",{parentName:"p"},"readiness probe")," y\n",(0,i.kt)("inlineCode",{parentName:"p"},"livenes probe")," para que no interfieran con el inicio del contenedor. Esto suele usarse en\ncontenedores lentos o aplicaciones de legado."),(0,i.kt)("p",null,"El startup probe lo que hace es esperar un tiempo de ",(0,i.kt)("inlineCode",{parentName:"p"},"failureThreshold * periodSeconds")," para\nproceder a realizar la prueba. Luego de salir ok el ",(0,i.kt)("inlineCode",{parentName:"p"},"readiness")," y ",(0,i.kt)("inlineCode",{parentName:"p"},"liveness")," empiezan a funcioanr"),(0,i.kt)("h4",{id:"ejemplo-completo"},"Ejemplo completo"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{10-15,17-21,23-28}","{10-15,17-21,23-28}":!0},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nspec:\n  containers:\n  - name: nginx\n    image: nginx:alpine\n\n    readinessProbe:\n      httpGet:\n        path: /\n        port: 80\n      initialDelaySeconds: 5\n      periodSeconds: 10\n\n    livenessProbe:\n      tcpSocket:\n        port: 80\n      initialDelaySeconds: 15\n      periodSeconds: 20\n    \n    startupProbe:\n      httpGet:\n        path: /healthz\n        port: liveness-port\n      failureThreshold: 30\n      periodSeconds: 10\n")),(0,i.kt)("h2",{id:"deployments"},"Deployments"),(0,i.kt)("p",null,"Es un template para crear un pod. Ademas tiene un conjunto de reglas y etiquetas para\nmanejar dichos pods."),(0,i.kt)("h3",{id:"replicas"},"Replicas"),(0,i.kt)("p",null,"Son la cantidad de pods que queremos en nuestro deployment, es decir, que si borramos un pod\nkubernetes instantaneamente creara uno de vuelta ya que siempre va a tratar de tener la cantidad\nde pods que especificamos en el numero de replicas."),(0,i.kt)("h3",{id:"manifiesto"},"Manifiesto"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{1-2,9}","{1-2,9}":!0},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  selector:\n    matchLabels:\n      app: nginx\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:alpine\n")),(0,i.kt)("h2",{id:"daemonset"},"DaemonSet"),(0,i.kt)("p",null,"Es una forma de deployar un pod pero este pod estara deployado en todos los nodos, es decir,\nsi tengo 3 nodos tendre 3 pods con una replica en cada nodo."),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Usa daemonset para servicios de monitoreo o captura de logs."))),(0,i.kt)("p",null,"Podemos obtener todos los DaemonSet que tenemos"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get ds\n")),(0,i.kt)("h3",{id:"manifiesto-1"},"Manifiesto"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{1-2}","{1-2}":!0},"apiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: nginx-deployment\nspec:\n  selector:\n    matchLabels:\n      app: nginx\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:alpine\n")),(0,i.kt)("h2",{id:"statefullset"},"StatefullSet"),(0,i.kt)("p",null,"Es una forma de deployar pods conservando sus estados atraves de volumenes, es decir, el pod se muere\ny todos los logs o informacion se elemina tambien, al guardarlos en un volumen lo que haremos es que\naunque muera el pod el nuevo pod que creara kubernetes apunte a dicho volumen conservando la informacion."),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Esto es util para bases de datos por ejemplo."))),(0,i.kt)("p",null,"Podemos hacer un get de todos los ",(0,i.kt)("inlineCode",{parentName:"p"},"sts")," que tenemos, ",(0,i.kt)("inlineCode",{parentName:"p"},"sts")," es la abreviacion de statefullset."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get sts\n")),(0,i.kt)("h3",{id:"pvc-persistant-volume-claim"},"PVC (Persistant Volume Claim)"),(0,i.kt)("p",null,"Debido a que estamos usando ",(0,i.kt)("inlineCode",{parentName:"p"},"StatefullSet")," y estos estan asociados con volumenes los cuales al final del\ndia son discos duros persistentes, cuando declaramos el volumen kubernetes se conecta a la api\ndel proveedor de nube y le solicita crear dicho disco duro, configurarlo y realizar el attach al nodo solicitante.\nPara esto usamos el ",(0,i.kt)("inlineCode",{parentName:"p"},"StorageClassName"),"."),(0,i.kt)("p",null,"Para poder saber cuales son los pvc que tenemos podemos ejecutar el siguiente comando:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pvc\n\nkubectl describe pvc ${PVC_NAME}\n")),(0,i.kt)("h3",{id:"manifiesto-2"},"Manifiesto"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{1-2,10,22-24,26-35}","{1-2,10,22-24,26-35}":!0},'apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: my-csi-app-set\nspec:\n  selector:\n    matchLabels:\n      app: mypod\n  serviceName: "my-frontend"\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: mypod\n    spec:\n      containers:\n      - name: my-frontend\n        image: busybox\n        args:\n        - sleep\n        - infinity\n        volumeMounts:\n        - mountPath: "/data"\n          name: csi-pvc\n\n  volumeClaimTemplates:\n  - metadata:\n      name: csi-pvc\n    spec:\n      accessModes:\n      - ReadWriteOnce\n      resources:\n        requests:\n          storage: 5Gi\n      storageClassName: do-block-storage\n')),(0,i.kt)("h2",{id:"networking"},"Networking"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"El pod es el que tiene la ip no los contenedores, es decir, si tengo 3 contenedores dentro\nde un pod asegurarme de cambiar los puertos para que no colisionen entre si")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Hay un agente dentro de kubernetes llamado `` que se encarga de crear\nlas diferentes rutas para que los pods puedan comunicarse entre los nodos o instancias.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Kubernetes tiene una base de datos en ",(0,i.kt)("inlineCode",{parentName:"p"},"etcd")," que es la encaragda de almancenar las rutas y\nlos estados de los workers")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Cada nodo tiene su propia ip"))),(0,i.kt)("h3",{id:"tipos-de-networking"},"Tipos de networking"),(0,i.kt)("p",null,"Existen 4 tipos de comunicacion en las  redes dentro de los clusters:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Contenedor a contenedor"),(0,i.kt)("li",{parentName:"ol"},"Pod a pod"),(0,i.kt)("li",{parentName:"ol"},"pod a servicio"),(0,i.kt)("li",{parentName:"ol"},"Externo a servicio")),(0,i.kt)("p",null,"Existen 3 reglas principales:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Todos los pods se pueden comunicar con todos los otros pods sin necesidad de usar una NAT."),(0,i.kt)("li",{parentName:"ol"},"Todos los nodeos se pueden comunicar con todos los otros pos sin necesidad de una NAT."),(0,i.kt)("li",{parentName:"ol"},"La misma IP que el pod mira es la misma que los demas pods ven.")),(0,i.kt)("h4",{id:"contenedor-a-contenedor"},"Contenedor a Contenedor"),(0,i.kt)("p",null,"Los contenedores dentro de un mismo pod contienen la misma ip por ende podemos\ncomunicarnos con otros contenedores usando ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," y un puerto diferente para\ncada contenedor."),(0,i.kt)("p",null,"Usando el parametro ",(0,i.kt)("inlineCode",{parentName:"p"},"containerPort")," podemos asignar puertos a los contenedores dentro del pod"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{19}","{19}":!0},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: my-nginx\nspec:\n  selector:\n    matchLabels:\n      run: my-nginx\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        run: my-nginx\n    spec:\n      containers:\n      - name: my-nginx\n        image: nginx\n        ports:\n        - containerPort: 80\n\n")),(0,i.kt)("h4",{id:"pod-a-pod"},"Pod a Pod"),(0,i.kt)("p",null,"Tenemos 2 tipos de comunicacion:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"pods dentro del mismo worker node")),(0,i.kt)("p",null,"Para llevar a cabo esta tarea hacemos uso de veth la cual creara una bridge\npara comunicar el pod network namespace con el root network namespace del nodo."),(0,i.kt)("p",null,"Con esto conseguimos que un pod se pueda comunicar con otro usando su direccion ip."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Routing: permite comunicar multiples redes de forma independiente y manteniendolas\nseparadas usando un router."),(0,i.kt)("p",{parentName:"div"},"Bridge: permite conectar dos redes independientes y que parezcan que son una sola\nusando un bridge"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"pods en diferentes worker nodes")),(0,i.kt)("p",null,"esto depende bastante de cada proveedor de nube debido a que dicha conexion es\nnetwork specific. por ejemplo en el caso de aws tiene su propia implementacion del\nCNI."),(0,i.kt)("h4",{id:"pod-a-servicio"},"Pod a servicio"),(0,i.kt)("p",null,"Como un servicio crea una ip estatica que luego la usamos en la ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables")," que esta\ndentro del nodo la cual nos va a servir posteriormente en la NAT. Podemos usar dicha ip\npara conectarnos desde cualquier nodo a un servicio"),(0,i.kt)("h4",{id:"exterior-a-un-servicio"},"Exterior a un servicio"),(0,i.kt)("p",null,"Egress es como el trafico de los nodos sale hacia el internet.\nEste usa el CNI plugin para poder hablar con la vpc"),(0,i.kt)("p",null,"Ingress por otro lado es como el trafico que viene de internet redirigirlo internamente.\nusa los servicios de k8s"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"podemos usar el load balancer service el cual es de tipo capa 4 (TCP/UDP)"),(0,i.kt)("li",{parentName:"ul"},"mientras que el ingress es un load balancer de capa 4 o capa 7")),(0,i.kt)("h3",{id:"servicios"},"Servicios"),(0,i.kt)("p",null,"Los servicios en kubernetes son una forma de poder contactar un set de pods ya sea desde adentro\ndel cluster o desde afuera, por medio de una direccion que se mantiene incluso si el pod muere"),(0,i.kt)("p",null,"Utilizaremos como base este manifiesto de deployment"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"title='deployment.yaml'",title:"'deployment.yaml'"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: hello\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      role: hello\n  template:\n    metadata:\n      labels:\n        role: hello\n    spec:\n      containers:\n      - name: hello\n        image: gcr.io/google-samples/hello-app:1.0\n        ports:\n        - containerPort: 8080\n")),(0,i.kt)("p",null,"Principalmente hay 3 servicios en Kubernetes."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Clusterip Crea una ip fija  privada que esta dentro del cluster, que basicamente sirve como\n",(0,i.kt)("inlineCode",{parentName:"li"},"loadbalancer")," entre todos los pods que le asigne a ese servicio, es decir, yo me puedo conecar a un pod\ny hacer un ping a es ip fija y la debe resolver. Todo esto sirve de forma interna")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"title='cluster-ip.yaml' {6,11}",title:"'cluster-ip.yaml'","{6,11}":!0},"apiVersion: v1\nkind: Service\nmetadata:\n  name: hello\nspec:\n  type: ClusterIP\n  ports:\n  - port: 8080\n    targetPort: 8080\n  selector:\n    role: hello\n")),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Cuando usar CluusterIp?"),(0,i.kt)("ul",{parentName:"div"},(0,i.kt)("li",{parentName:"ul"},"debugging"),(0,i.kt)("li",{parentName:"ul"},"dashboards internos"),(0,i.kt)("li",{parentName:"ul"},"Testing")))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Node port es otro servicio en kubernetes, este crea un puerto en cada nodo que va a recibir el trafico\ny lo va a mandar a los pods que tenga ese servicio.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"title='node-port.yaml' {6,10,12}",title:"'node-port.yaml'","{6,10,12}":!0},"apiVersion: v1\nkind: Service\nmetadata:\n  name: hello\nspec:\n  type: NodePort\n  ports:\n  - port: 8080\n    targetPort: 8080\n    nodePort: 30000\n  selector:\n    role: hello\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Loadbalancer esta mas atado a la nube, lo que hara kubernetes es crear un balanceador de carga en nuestro\nproveedor de nube y redireccionar el trafico por nuestros pods.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"title='load-balancer.yaml' {6,11}",title:"'load-balancer.yaml'","{6,11}":!0},"apiVersion: v1\nkind: Service\nmetadata:\n  name: hello\nspec:\n  type: LoadBalancer\n  ports:\n  - port: 8080\n    targetPort: 8080\n  selector:\n    role: hello\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Headless envia traficos a pods especificos esto es util cuando tenemos statefullsets como DB")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Service\nmetadata:\n  name: hello\nspec:\n  type: ClusterIP\n  ports:\n  - port: 8080\n  clusterIp: None \n  selector:\n    role: hello\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"ExternalName esto no retorna una ip estatica sino un CNAME el cual k8s identifica por medio de un DNS.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Service\nmetadata:\n  name: hello\nspec:\n  type: ExternalName\n  externalName: my.database.example.com\n")),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Pro tip:\nBusybox es como la cajita de herramientas o la navaja suiza. Tiene mas de 300 utilidades de UNIX\ny nos sera de mucha ayuda al momento de debuguear pods. para usarlo podemos ejecutar"),(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl run --it --rm --restart=Never busybox --image=grc.io/google-containers/busybox sh \n")))),(0,i.kt)("h3",{id:"traffic-policies"},"Traffic policies"),(0,i.kt)("p",null,"Con estas politicas podemos determinar como enrutar el trafico de los pods."),(0,i.kt)("p",null,"External e Internal tiene los mismos tipos los cuales son:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"cluster Enruta el trafico con todos los ready endpoints"),(0,i.kt)("li",{parentName:"ul"},"local Enruta el trafico solo con los ready endpoints locales del nodo.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{12}","{12}":!0},"apiVersion: v1\nkind: Service\nmetadata:\n  name: my-service\nspec:\n  selector:\n    app: MyApp\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 9376\n  internalTrafficPolicy: Local\n")),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Si tenemos el traffic policie puesto en local y no tenemos ningun nodo ready en el nodo\nel trafico no se enrutara."))),(0,i.kt)("h3",{id:"ingress"},"Ingress"),(0,i.kt)("p",null,"Basicamente lo que hace el ingress es un nuevo tipo de recurso en kubernetes que te permite hacer redirecciones\nde trafico sobre tus pods de formas mas avanzadas, por ejemplo path base. Redirecciono a que pod quiero ir\npor medio del path asi no debo estar creando subdominios, etc.\nEl trafico llega a un ingress controller que puede ser de nginx este a su vez lo redirecciona a un ingress services\nque definen las rutas que van a los servicios del cluster y esto lo mandan a los pods."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: hello-app\nspec:\n  rules:\n  - http:\n      paths:\n      - path: /v1\n        pathType: Prefix\n        backend:\n          service:\n            name: hello-v1\n            port:\n              number: 8080\n      - path: /v2\n        pathType: Prefix\n        backend:\n          service:\n            name: hello-v2\n            port:\n              number: 8080\n")),(0,i.kt)("h3",{id:"dns-domain-name-system"},"DNS (Domain Name system)"),(0,i.kt)("p",null,"Es el servicio responsable de hacer la traduccion de un nombre a una ip."),(0,i.kt)("p",null,"Kubernetes usa CoreDNS para realizar dicha traduccion. CoreDNS se asegura de\nque los pods y servicios FQDN (Fully qualified domain name). Sin CoreDNS la\ncomunicacion en el cluster no seria posible."),(0,i.kt)("p",null,"Podemos usar varios plugins para coreDNS.\nCoreDNS se encuentra como servicio en el namespace de kube-system con el nombre\nde kube-dns para obtenerlo podemos hacer"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get services kube-dns -n kube-system\n")),(0,i.kt)("p",null,"Ademas cada pod tiene un archivo de configuracion para ayudar al DNS\nLo encontramos ejecutando el siguiente comando"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl exec --it my-pod -- sh\ncat /etc/resolv.conf\n")),(0,i.kt)("p",null,"Tambien podemos usar una utilidad de linux llamada ",(0,i.kt)("inlineCode",{parentName:"p"},"nslookup"),"\npara ver la ip de los CNAMES"),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Que es FQDN?\nEs lo que se conoce como absolute domain el cual es la ubicacion exacta en el\narbol de jerarquia."))),(0,i.kt)("h2",{id:"configmaps-1"},"ConfigMaps"),(0,i.kt)("p",null,"Es usado para almacenar informacion no confidencial usando ",(0,i.kt)("inlineCode",{parentName:"p"},"key:value")," pair.\nEste archivo lo hosteo en kubernetes y puede ser accedido desde los pods."),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Esto puede ser usado para generar archivos de configuracion por stage o para las variables\nde entorno, es decir, Podemos usar los confimaps para:"),(0,i.kt)("ol",{parentName:"div"},(0,i.kt)("li",{parentName:"ol"},"variables de entorno"),(0,i.kt)("li",{parentName:"ol"},"argumentos para las lineas de comandos"),(0,i.kt)("li",{parentName:"ol"},"archivos de configuracion")))),(0,i.kt)("h3",{id:"manifiesto-3"},"Manifiesto"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"title='config-map.yaml'",title:"'config-map.yaml'"},'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: game-demo\ndata:\n  # property-like keys; each key maps to a simple value\n  player_initial_lives: "3"\n  ui_properties_file_name: "user-interface.properties"\n  #\n  # file-like keys\n  game.properties: |\n    enemy.types=aliens,monsters\n    player.maximum-lives=5\n  user-interface.properties: |\n    color.good=purple\n    color.bad=yellow\n    allow.textmode=true\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"title='pod.yaml'",title:"'pod.yaml'"},'apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nspec:\n  containers:\n    - name: nginx\n      image: nginx:alpine\n      env:\n        # Define the environment variable\n        - name: PLAYER_INITIAL_LIVES # Nombre de la variable\n          valueFrom:\n            configMapKeyRef:\n              name: game-demo           # El confimap desde donde vienen los valores\n              key: player_initial_lives # La key que vamos a usar\n        - name: UI_PROPERTIES_FILE_NAME\n          valueFrom:\n            configMapKeyRef:\n              name: game-demo\n              key: ui_properties_file_name\n      volumeMounts:\n      - name: config\n        mountPath: "/config"\n        readOnly: true\n  volumes:\n    - name: config\n      configMap:\n        name: game-demo # el nombre del configmap que queremos montar\n        items: # Un arreglo de keys del configmap para crear como archivos\n        - key: "game.properties"\n          path: "game.properties"\n        - key: "user-interface.properties"\n          path: "user-interface.properties"\n')),(0,i.kt)("h2",{id:"secrets"},"Secrets"),(0,i.kt)("p",null,"Es una forma de codificar nuestros secretos en base64 con el fin de que una persona normal\nal verlo no sepa los valores de dichos secretos."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"title='secrets.yaml'",title:"'secrets.yaml'"},"apiVersion: v1\nkind: Secret\nmetadata:\n  name: db-credentials\ntype: Opaque\ndata:\n  username: YWRtaW4=\n  password: c3VwM3JwYXNzdzByZAo=\n")),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Otra forma de hacerlo mas a mano es la siguiente:"),(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl create secret generic db-credentials \\\n--from-literal=username=admin \\\n--from-literal=password=sup3rpassw0rd\n")))),(0,i.kt)("p",null,"Para mas informacion podemos visitar la\n",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/es/docs/concepts/configuration/secret/"},"documentacion")),(0,i.kt)("h2",{id:"cloud-native"},"Cloud Native"),(0,i.kt)("p",null,"Kubernetes funciona muy bien con el concepto de cloud native\ndebido a que buscamos ser agnosticos a la nube y a su vez poder usar herramientas\npara todos los CSP"),(0,i.kt)("h3",{id:"roadmap"},"Roadmap"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Containerization (Docker)"),(0,i.kt)("li",{parentName:"ol"},"CI/CD (Github actions, jenkins, travis, argo, etc)"),(0,i.kt)("li",{parentName:"ol"},"Orchestation (Kubernetes)"),(0,i.kt)("li",{parentName:"ol"},"Observability (Grafana, fluentd)"),(0,i.kt)("li",{parentName:"ol"},"Services proxy, discovery and mesh"),(0,i.kt)("li",{parentName:"ol"},"Networking policie and security"),(0,i.kt)("li",{parentName:"ol"},"Distributed db and storage"),(0,i.kt)("li",{parentName:"ol"},"Streaming and messaging"),(0,i.kt)("li",{parentName:"ol"},"Container registry and runtime"),(0,i.kt)("li",{parentName:"ol"},"Software distribution")),(0,i.kt)("p",null,"Para mas informacion podemos ir al siguiente ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cncf/landscape/blob/master/README.md#trail-map"},"repo")),(0,i.kt)("h2",{id:"security"},"Security"),(0,i.kt)("p",null,"dentro de cloud native tenemos un concepto importante el cual es las 4C de seguridad.\nEstas son:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Cloud"),(0,i.kt)("li",{parentName:"ul"},"Clusters"),(0,i.kt)("li",{parentName:"ul"},"Containers"),(0,i.kt)("li",{parentName:"ul"},"Code")),(0,i.kt)("p",null,"Con estas 4c usamos el mecanismo ",(0,i.kt)("inlineCode",{parentName:"p"},"depth in defense"),". lo que quiere decir es que\nusamos las 4c como 4 capas en donde podemos implementar mecanismos de seguridad\npara que los atacantes tenga que ir pasando si quieren conseguir informacion valiosa."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"4cs",src:n(8534).Z})),(0,i.kt)("h3",{id:"cloud-layer-base-layer"},"Cloud Layer (base layer)"),(0,i.kt)("p",null,"La seguridad en esta capa sera self-managed infrastructure o managed."),(0,i.kt)("p",null,"en la self-managed debemos buscar que buenas practicas se deben seguir\nestas practicas van a cambiar segun el CSP."),(0,i.kt)("p",null,"Por otro lado en las managed debemos hacer todo por nuestra cuenta, es decir,\nrealizar las encriptaciones, manejar los usuarios, roles, permisos, acessos."),(0,i.kt)("h3",{id:"cluster-layer"},"Cluster Layer"),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Esto se aplica de forma general no importa que cluster estemos utilizando\nya sea kubernetes, docker swarm o mesos"))),(0,i.kt)("p",null,"En esta capa tenemos dos secciones importantes:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Componentes en el cluster: Aqui aseguramos las aplicaciones que se ejecutan\ndentro del cluster")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Componentes del cluster: Aqui aseguramos los componentes del cluster"))),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"responsabilidades-cluster-layer",src:n(2580).Z})),(0,i.kt)("h3",{id:"container-and-code-layer"},"Container and Code layer"),(0,i.kt)("p",null,"Container"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Container vulnerability scanning"),(0,i.kt)("li",{parentName:"ul"},"image signing"),(0,i.kt)("li",{parentName:"ul"},"Disallow privileged users"),(0,i.kt)("li",{parentName:"ul"},"Use container runtime with strong isolation")),(0,i.kt)("p",null,"Code"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Solo usar https"),(0,i.kt)("li",{parentName:"ul"},"Limitar el rango de puertos que usa la aplicacion"),(0,i.kt)("li",{parentName:"ul"},"3rd services dependecy"),(0,i.kt)("li",{parentName:"ul"},"Analisis de codigo estatico"),(0,i.kt)("li",{parentName:"ul"},"Dynamic probing attack (pentesting)")))}m.isMDXComponent=!0},8534:function(e,a,n){a.Z=n.p+"assets/images/4cs-826dd41ef2aa54a1d10da9af0b014f11.png"},2580:function(e,a,n){a.Z=n.p+"assets/images/cluster-layer-863fb7c2a422e46c002f725e59e1d4c8.png"},7280:function(e,a,n){a.Z=n.p+"assets/images/kubelet-comunication-79eb5e0d21c98d98228ad704b9264d3b.png"}}]);