<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">Terraform | Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://jatobrun.github.io/docs/herramientas/terraform"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Terraform | Docs"><meta data-react-helmet="true" name="description" content="Es una IaC tool que es open-source y cloud agnostic, usa lenguaje declarativo."><meta data-react-helmet="true" property="og:description" content="Es una IaC tool que es open-source y cloud agnostic, usa lenguaje declarativo."><link data-react-helmet="true" rel="icon" href="/docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://jatobrun.github.io/docs/herramientas/terraform"><link data-react-helmet="true" rel="alternate" href="https://jatobrun.github.io/docs/herramientas/terraform" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://jatobrun.github.io/docs/herramientas/terraform" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.08ce278c.css">
<link rel="preload" href="/docs/assets/js/runtime~main.513486dd.js" as="script">
<link rel="preload" href="/docs/assets/js/main.a282ba5e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/docs/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">My Doc</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jatobrun/docs/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/db/sql">DB</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/aws/cloud-practitioner">AWS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/herramientas/docker">Herramientas</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/herramientas/docker">Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/herramientas/kubernetes">Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/herramientas/git">GIT</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/herramientas/terraform">Terraform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/herramientas/ux">UI y UX</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/herramientas/jira">Jira</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/herramientas/DDD">Domain Driven Design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/herramientas/cloud">Cloud Computing</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/lenguajes/dart">Lenguajes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/gcp/cloud-digital-leader">GCP</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/az/az-900">AZURE</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Terraform</h1></header><p>Es una IaC tool que es open-source y cloud agnostic, usa lenguaje declarativo.
Usa lenguaje HCL (HashiCorp Configuration Language), tiene features interesantes como:</p><ul><li>Instalacion de modulos </li><li>Cambios planeados y predictivos</li><li>Grafico de dependencias</li><li>Terraform registry </li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="traditional-it">Traditional IT<a class="hash-link" href="#traditional-it" title="Direct link to heading">â€‹</a></h2><p><img alt="arquitectura tradicional" src="/docs/assets/images/traditional-it-23f7c16bffb1bdbb380410a03ebca967.png"></p><ul><li>Donde el equipo de <code>business</code> son los encargados de decir que nuevas acciones se
debe implementar.</li><li>El equipo de <code>business analytics</code> se encarga de evaular la efectividad y rentabilidad
de dichas ideas priorizando las mejores ideas.</li><li>El <code>solutions architect</code> es el encargado de maquetar la idea, es decir, pensar cuantos
servidores se van a necesitar, firewalls, cual seria la mejor clase de storage, etc.</li><li>El equipo de <code>procurement</code> se encarga de comprar todos los elements de la lista de materiales
que el <code>solutions architect</code> necesita para implementar la idea.</li><li>Una vez ya se cuente con todo el <code>hardware</code> este para al <code>infraestructure team</code> el cual se
encarga de montar los elementos (<code>field engineers</code>), aprovisionar del software (<code>system administrators</code>),
aprovisionar bases de datos, storate (<code>storage admins</code>), crear los horarios de backups (<code>backups admins</code>).</li><li>Por ultimo los <code>desarrolladores</code> ya se encuentran listos para desplegar sus desarrollos en dicho hardware.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="desventajas">Desventajas<a class="hash-link" href="#desventajas" title="Direct link to heading">â€‹</a></h3><ul><li>Tiempos de espera muy elevados </li><li>Costos elevados </li><li>Dificultad en la automatizacion (no puedes automatizar que monten un rack o conectar cables)</li><li>Errores humanos </li><li>Inconsistencia en los ambientes </li><li>No todos los recursos los consumes </li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="cloud">Cloud<a class="hash-link" href="#cloud" title="Direct link to heading">â€‹</a></h2><p>Debido a que hemos visto las desventajas de usar el modelo anterior, la nube nos ayuda mucho ya que
no debemos manejar todos los gastos de infraestructura o hardware (<code>Capex</code>) sino mas bien nos enfocamos
en usar esos recursos que ya estan disponibles por el <code>CSP</code>. Esto hace que:</p><ul><li>Nuestros tiempos se reduzcan</li><li>Costos reducidos, <code>pays as you go</code></li><li>Podemos automatizar el levantar un server nuevo (Porque el <code>CSP</code> ya tiene levantado los servers y cuenta con APIS).</li><li>Podamos escalar de forma horizontal o vertical sin problemas por ende ya no hay tanto desperdicio de recursos.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="configuracion-manual">Configuracion Manual<a class="hash-link" href="#configuracion-manual" title="Direct link to heading">â€‹</a></h2><p>Configurar de forma manual nuestra infraestructura en la nube ayuda a que podamos prototipar y
usar nuevos servicios que el proveedor de nube crea. Pero este metodo tambien viene con varios problemas </p><ul><li>Es facil desconfigurar un servicio que ya este funcionando (error humano)</li><li>Es dificil de manejar estados de los servicios </li><li>Es dificil transferir configuraciones de servicios con el equipo</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="infraestructura-como-codigo">Infraestructura como codigo<a class="hash-link" href="#infraestructura-como-codigo" title="Direct link to heading">â€‹</a></h3><p><code>IaC</code> es la forma en la que nosotros declaramos nuestra infraestructura como un blueprint,
estos scripts los utilizamos para provisionar (crear, actualizar o eliminar) los
requerimientos de hardware que se necesiten de una forma consistente y automatizada.
Podemos utilizar herramientas para llevar esto a cabo, las dos mas usadas son:</p><ul><li><code>Ansible</code></li><li><code>Terraform</code></li></ul><p>Ambas tecnologias tienen sus diferencias por ende tienen diferentes casos de uso.</p><p>Algunas otras tecnologias para <code>IaC</code>:</p><ul><li><code>puppet</code></li><li><code>saltstack</code></li><li><code>packer</code></li><li><code>cloudformation</code></li><li><code>vagrant</code></li><li><code>docker</code></li></ul><p>Como cada una de estas herramientas estan creadas para casos especificos podemos crear grupos:</p><ul><li><p><code>Configuration Management</code></p><ul><li><code>puppet</code>, <code>ansible</code>, <code>saltstack</code></li></ul></li><li><p><code>Server templating</code></p><ul><li><code>docker</code>, <code>packer</code>, <code>vagrant</code></li></ul></li><li><p><code>Provisioning tools</code></p><ul><li><code>cloudformation</code>, <code>terraform</code></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="configuration-management">Configuration Management<a class="hash-link" href="#configuration-management" title="Direct link to heading">â€‹</a></h3><p>Esto se usa para mantener infraestructura, instalar (instalar dependencias) y manejar software
(actualizar dependencias o eliminarlas), crear scripts de backups, la idea es que si tienes que
hacer una actualizacion de una dependencia en 100 maquinas no debas ir una por una actualizando
sino que con un script de <code>ansible</code> ejecutes todas de golpe. </p><p>Asi podemos tener <code>control de versiones</code>, dentro de nuestros ambientes o instancias.</p><p>Tambiente es <a href="#idempotent">idempotent</a>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="server-templating">Server Templating<a class="hash-link" href="#server-templating" title="Direct link to heading">â€‹</a></h3><h3 class="anchor anchorWithStickyNavbar_y2LR" id="provisioning-tools">Provisioning tools<a class="hash-link" href="#provisioning-tools" title="Direct link to heading">â€‹</a></h3><h3 class="anchor anchorWithStickyNavbar_y2LR" id="iac-declarativa">IaC Declarativa<a class="hash-link" href="#iac-declarativa" title="Direct link to heading">â€‹</a></h3><ul><li>Todo se maneja de forma explicita, es decir lo que escribes es lo que obtienes</li><li>Mas verbosa, por ende menos chance de desconfigurar </li><li>Usa scripting languages.(JSON, XML, YAML)</li></ul><p>Ejemplos:</p><ul><li>ARM Templates (Azure)</li><li>CLoud formation (AMAZON)</li><li>Azure blueprint </li><li>Cloud deployment manager (GCP)</li><li>Terraform</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="iac-imperativa">IaC Imperativa<a class="hash-link" href="#iac-imperativa" title="Direct link to heading">â€‹</a></h3><ul><li>Tu dices que es lo que quieres y el resto se infiere</li><li>menos verboso por ende tienes mas chance de crear alguna desconfiguracion </li><li>Usa lenguajes de programacion (Python, Javascript, Ruby)</li></ul><p>Ejemplos </p><ul><li>Amazon cloud development kit</li><li>Pulumi</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Aunque terraform es declarativo e <a href="#idempotent">idempotent</a> tiene algunas features
interesantes de la IaC imperativa. El lenguaje que usa terraform es <strong>HCL-ish</strong> el cual soporta:</p><ul><li>Bucles </li><li>Bloques dinamicos </li><li>Estructuras de datos complejas</li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="infrastructure-lifecycle">Infrastructure lifecycle<a class="hash-link" href="#infrastructure-lifecycle" title="Direct link to heading">â€‹</a></h2><p>Son las fases claras y bien definidas que usan los Devops engineer para planear, diseÃ±ar
, construir, testear, entregar y mantener infraestructura en la nube.</p><p>Hay una metodologia muy usada llamada Day 0 - Day 1 y Day 2</p><p>Day 0 - 2 es una forma simplificada de describir las fases que tiene la infrastructure lifecycle</p><p>Day 0 significa vamos a planear y diseÃ±ar
Day 1 significa vamos a contruir y testear
Day 2 significa vamos a salir a produccion y mantenerla </p><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>Los days no estan sujetos a los dias de 24 horas, pueden durar semanas, solo es una forma de decir</p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="key-terms">Key Terms<a class="hash-link" href="#key-terms" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="idempotent">Idempotent<a class="hash-link" href="#idempotent" title="Direct link to heading">â€‹</a></h3><p>Lo que quiere decir es que podemos ejecutar el codigo multiples veces
y siempre tendremos el mismo resultado, es decir, realizara los cambios necesarios para llevarlo
al estado deseado.</p><p>Ejemplo
Si tenemos un IaC config file con dos VM lo que pasara es que las creara y las lanzara</p><p>Non-idempotent
Si volvemos a ejecutar el IaC config file volvera a lanzar 2 VM a pesar de que ya
tenemos dos VM ya en la nube por ende terminamos con 4 VM pero nosotros deseamos solo tener 2</p><p>idempotent
Si volvemos a ejecutar el IaC config file no pasara, porque ya tenemos 2 VM entonces o las
actualizara o las destruira y creara.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="provisioning">Provisioning<a class="hash-link" href="#provisioning" title="Direct link to heading">â€‹</a></h3><p>Es cuando preparamos los servidores, con software, configuracion, data para que esten aptos para realizar
tareas, es decir, cuando lanzamos y configuramos cualquier servicio de la nube estamos haciendo <code>provisioning</code>.
Podemos usar <a href="#configuration-management">config-managment-tools</a></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="deployment">Deployment<a class="hash-link" href="#deployment" title="Direct link to heading">â€‹</a></h3><p>Es la accion de enviar una version de nuestra aplicacion a un servidor previamente provisionado.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="orchestration">Orchestration<a class="hash-link" href="#orchestration" title="Direct link to heading">â€‹</a></h3><p>Es la accion de coordinar multiples servicios. Esta mas relacionado con microservicios, contenedores.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="configuration-drift">Configuration Drift<a class="hash-link" href="#configuration-drift" title="Direct link to heading">â€‹</a></h3><h3 class="anchor anchorWithStickyNavbar_y2LR" id="inmutable-vs-mutable-infraestructure">Inmutable vs Mutable infraestructure<a class="hash-link" href="#inmutable-vs-mutable-infraestructure" title="Direct link to heading">â€‹</a></h3><p>Mutable
Es cuando</p><ol><li>desplegamos un servicio (terraform)</li><li>configuramos con ansible (sudo ap update, install, etc).</li></ol><p>El problema con esto es que no podemos garantizar que siempre tendremos lo mismo porque las librerias
cambian, los sistemas cambian, etc.</p><p>Inmutable
Es cuando </p><ol><li>provisionamos un servicio (Terraform)</li><li>creamos y almancenamos una imagen (packer)</li><li>desplegamos</li></ol><p>Con la imagen podemos garantizar que siempre vamos a tener el mismo software y con terraform que siempre
tendremos el mismo hardware.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="gitops">GitOps<a class="hash-link" href="#gitops" title="Direct link to heading">â€‹</a></h3><p>Es cuando introducimos un proceso formal de revisar y aceptar cambios en la infraestructura, por medio de
un repositorio de git e IaC files. Luego cuando ya el codigo este aceptado por medio de un trigger
actualizamos dicha infraestructura.</p><p><img alt="gitops" src="/docs/assets/images/gitops-223937080c003954cd43e8a282248adf.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="execution-plan">Execution plan<a class="hash-link" href="#execution-plan" title="Direct link to heading">â€‹</a></h3><p>es un review manual de los recursos que se van a agregar, actualizar o eliminar antes de aplicar
<code>terraform apply</code>.
Podemos visualizar el execution plan usando <code>terraform graph</code>. Al ejecutar dicho compando obtendremos
un archivo de tipo <strong>graphviz</strong> (Para poder visualizar el archivo necesitaremos GraphViz)</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">terraform graph </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> dot -Tsvg </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> graph.svg</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Terraform construye un grafico de dependencia para ejecutar el execution plan. Este dependecy graph
tiene 3 tipo de elementos </p><ul><li>Resource node (rectangulo): representa un recurso unico</li><li>Resource meta-node (circulo): representa un grupo de recursos</li><li>Provider configuration node (rombo): representa el proveedor de nube que usaremos.</li></ul><p><img alt="dependency-graph" src="/docs/assets/images/dependecy-graph-bec318bc110ab9d4dfc395d0bd7b8ad0.png"></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="terraform-lifecycle">Terraform Lifecycle<a class="hash-link" href="#terraform-lifecycle" title="Direct link to heading">â€‹</a></h2><ol><li>Creamos o configuramos nuestros terraform config file </li><li>init, inicializamos el repositorio hacemos pull los proveedores y modulos que usaremos</li><li>plan, creamos plan de ejecucion</li><li>validate, validamos si los tipos y los valores son correctos </li><li>apply, ejecutamos el plan de ejecucion (provisionamos la infraestructura)
5.1. Destruimos la infraestructura remota (si es necesario)</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="cheatsheet">CheatSheet<a class="hash-link" href="#cheatsheet" title="Direct link to heading">â€‹</a></h2><ul><li><code>terraform init</code> descarga los modulos y provisioners de nuestro main.tf file </li><li><code>terraform fmt</code> es como el linter de terraform, modifica los archivos
para tener el style guide debio</li><li><code>terraform validate</code> valida si nuestros manifiestos estan correctos o nos falta
alguna configuracion</li><li><code>terraform plan</code> crea el execution plan de los resources que se van a crear </li><li><code>terraform apply</code> ejecuta terraform plan y ademas crear los recursos del terrraform plan</li><li><code>terraform destroy o terraform apply -destroy</code> para eliminar los recursos en la nube<div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p><code>terraform validate</code> no valida el valor de los campos solo que los campos necesarios
existan y contengan el tipo de dato que se indica</p></div></div></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="input-variables">input Variables<a class="hash-link" href="#input-variables" title="Direct link to heading">â€‹</a></h2><p>En terraform podemos crear variables para definir ciertos valores al momento de
ejecutar el apply. Esto nos ayuda a no quemar valores y que sean mas flexibles </p><p>Opcion 1</p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">main.tf</div><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;nombre-de-la-variable&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type = string </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Luego para usar dicha varibale declarada en el <code>main.tf</code> podemos hacer lo siguiente </p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">main.tf</div><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;recurso&quot; &quot;nombre-del-recurso&quot;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ami = var.nombre-de-la-variable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p> y luego para ejecutarlo pasamos las variables en el comando </p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">terrafrom plan -var=nombre-de-la-variable=&quot;t2.micro&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Opcion 2</p><p>Crear el archivo <code>terraform.tfvars</code> y dentro del mismo agregar las variables </p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">terraform.tfvars</div><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">nombre-de-la-variable=&#x27;t2.medium&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>De esta manera podemos ejecutar <code>terraform plan</code> sin necesidad de pasarle dichas variables
por consola. Es como usar un archivo tipo <code>.env</code></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="locals">Locals<a class="hash-link" href="#locals" title="Direct link to heading">â€‹</a></h3><p>Son como las variables pero hardcode y podemos usar string interpolation </p><p>Para definir un local </p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">main.tf</div><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">locals {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    project_code = &#x27;003&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Para usar un local </p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">main.tf</div><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;recurso&quot; &quot;nombre-del-recurso&quot;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ami = var.nombre-de-la-variable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tags = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name = &#x27;Servidor-${local.project_code}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Para no tener todo (outputs, locals, variables) en el <code>main.tf</code> podemos dividirlo en
archivos como <code>variables.tf</code>, <code>output.tf</code> y <code>providers.tf</code> con esto generamos
una buena practica</p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="default-option">Default option<a class="hash-link" href="#default-option" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">main.tf</div><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;nombre-de-la-variable&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type = string </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default = &quot;hola&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="list">List<a class="hash-link" href="#list" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">main.tf</div><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;nombre-de-la-variable&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type = list(string )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default = [&quot;hola&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="objects">Objects<a class="hash-link" href="#objects" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">main.tf</div><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;nombre-de-la-variable&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type = object({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        internal = number </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        external = number </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol = string </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        internal = 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        externa = 20 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol = &quot;tcp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="types">Types<a class="hash-link" href="#types" title="Direct link to heading">â€‹</a></h3><ul><li>number </li><li>string </li><li>boolean </li><li>list</li><li>set</li><li>object</li><li>map</li><li>tuple</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="validations">Validations<a class="hash-link" href="#validations" title="Direct link to heading">â€‹</a></h3><p>POdemos usar un bloque de validacion con el fin de incremetar la seguridad
de nuestros manifiestos y que las personas al ingresar variables no tengan
tanto error humano </p><div class="codeBlockContainer_J+bg language-terrform theme-code-block"><div class="codeBlockContent_csEI terrform"><pre tabindex="0" class="prism-code language-terrform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;image_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The id of the machine image (AMI) to use for the server.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition     = length(var.image_id) &gt; 4 &amp;&amp; substr(var.image_id, 0, 4) == &quot;ami-&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;The image_id value must be a valid AMI id, starting with \&quot;ami-\&quot;.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Tambien podemos usar regex para realizar la validacion </p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;image_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The id of the machine image (AMI) to use for the server.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # regex(...) fails if it cannot find a match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition     = can(regex(&quot;^ami-&quot;, var.image_id))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;The image_id value must be a valid AMI id, starting with \&quot;ami-\&quot;.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="environment-variables">Environment variables<a class="hash-link" href="#environment-variables" title="Direct link to heading">â€‹</a></h3><p>Para las variables de entorno debemos exportarlas con <code>TF_VAR_cualquier_cosa</code>
con esto logramos que terraform las entienda y las pueda asignar a los lugares
correspondiendtes </p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_contrasena</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;123456789&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="sensitive-variables">Sensitive variables<a class="hash-link" href="#sensitive-variables" title="Direct link to heading">â€‹</a></h3><p>Podemos tener algunas variables que pueden ser sensibles como la contraseÃ±a de una base de datos
en produccion o una ip de algun servidor de produccion, para evitar mostrar esto valores con
<code>terraform plan</code> o <code>terraform apply</code>, podemos usar el campo <code>sensitive = true</code></p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;user_information&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = object({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name    = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sensitive = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;some_resource&quot; &quot;a&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name    = var.user_information.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  address = var.user_information.address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>con esto obtenemos que no se muestren dichos valores en el execution plan.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="cargar-variables">Cargar variables<a class="hash-link" href="#cargar-variables" title="Direct link to heading">â€‹</a></h3><p>Hay variamos metodos para usar variables de entorno</p><ol><li><p>Crear un archivo <code>terraform.tfvars</code> todas las variables en dicho archivo se cargan
automaticamente </p></li><li><p>Crear un archivo <code>dev.tfvars</code> este archivo no se carga automaticamente debemos pasarlo
por comando</p></li><li><p>Crear un archivo <code>dev.auto.tfvars</code> este archivo si se carga automaticamente </p></li><li><p>Por comando <code>-var-file dev.tfvars</code> asi cargamos el archivo de la opcion 2 </p></li><li><p>Por comando tambien podemos modificar variables <code>-var ec2-type=t2.micro</code></p></li><li><p>haciendo un export de <code>export TF_VAR_hola</code></p></li></ol><h3 class="anchor anchorWithStickyNavbar_y2LR" id="jerarquia">jerarquia<a class="hash-link" href="#jerarquia" title="Direct link to heading">â€‹</a></h3><p>El nivel sobreescribe a todas las que estan abajo, es decir, el nivel 1 sobreescribe al 2,3 y4
el 2 sobreescribe al 3 y 4, el 3 solo al 4 y el 4 no sobreescribe a nadie </p><ol><li><p>Pasas por comando entonces <code>-var-file o -var </code> son las mas top </p></li><li><p>*.auto.tfvars </p></li><li><p>terraform.tfvars</p></li><li><p>environmental variables</p></li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="outputs">Outputs<a class="hash-link" href="#outputs" title="Direct link to heading">â€‹</a></h2><p>Es una forma de obtener la informacion clave de los recursos que ya provisionamos.</p><p>Por ejemplo estamos reservando un ip publica, y queremos saber el valor de dicha ip.
O estamos creando una VM y queremos saber su ip privada para crear una subnet o hacer networking.</p><p>Para todos esos casos debemos usar outputs.</p><p>Para definir un output</p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">main.tf</div><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;instance_ip&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value = aws_instance.my_server.public_ip #resource.name.atributo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Podemos usar <code>terraform output</code> para ver todos los valores claves que definimos asi no tenemos
que estar buscandolos en la pagina del proveedor o ejecutar multiples veces de terraform plan.</p><p>Tambien podemos saber el valor de un output en particular con <code>terraform output ${parametro}</code></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>En caso de que no funcione podemos hacer un <code>terraform refresh</code></p></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Para no tener todo (outputs, locals, variables) en el <code>main.tf</code> podemos dividirlo en
archivos como <code>variables.tf</code>, <code>output.tf</code> y <code>providers.tf</code> con esto generamos
una buena practica</p></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Algunos outputs podemos esconderlos para que al ejecutar terraform output no se muestren,
pero podemos seguir viendo dichos valores en el state file </p><p>tambien podemos pasar dos flags a <code>terraform output</code> los cuales son <code>-json</code> y <code>raw</code>, el primero
es una forma mas bonita de formatear los valores y el segundo es para usarlo en comandos de bash</p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="modulos">Modulos<a class="hash-link" href="#modulos" title="Direct link to heading">â€‹</a></h2><p>Es una forma de agrupar diferentes resources en un modulo con el fin de que sea mas sencillo
provisionarlos sin tener que estar configurando uno a uno. Vendria a ser como una libreria de
una sola funcion en python como numpy o pandas. Podemos crear nuestros propios modulos
o usar los que nos ofrece terraform.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>En caso de que al ejecutar <code>terraform plan</code> nos salga algun error, es muy probable que sea
porque no tiene descargado dicho modulo por ende lo solucionamos si ejecutamos <code>terraform init</code></p></div></div><p>Ejemplo</p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">main.tf</div><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">Falta google</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="provisioners">Provisioners<a class="hash-link" href="#provisioners" title="Direct link to heading">â€‹</a></h2><p>terraform provisioners son los que instalan software, editan archivos en las maquinas
que fueron provisionadas por terraform para esto tiene dos provisioners:</p><ul><li>cloud-init Este es el estandar para la inicializacion de las instancias podemos pasarle
un yaml o un script de bash </li><li>packer es un servicio compilador de imagenes </li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Se debe usar otros provisioners como ultimo recurso, normalmente hay mejores alternativas</p></div></div><p>Creamos un yaml de cloud init </p><div class="codeBlockContainer_J+bg language-yaml theme-code-block"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>luego se lo pasamos a terraform de la siguiente manera </p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Chef, salt and puppet son tools que estan dreprecated en terraform, y en general es
considerado una mala practica</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="local-exec">Local exec<a class="hash-link" href="#local-exec" title="Direct link to heading">â€‹</a></h3><p>Local exec te permite ejecutar comandos locales luego de provisionar un recurso</p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">main.tf</div><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_instance&quot; &quot;web&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    provisioner &quot;local-exec&quot;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        command = &quot;echo ${self.private_ip}, $KEY, $SECRET &gt;&gt; private_ip.txt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        interpreter = [&quot;&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        environment = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            KEY = &quot;dsasdasdas&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SECRET = &quot;dasdasd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="remote-exec">Remote exec<a class="hash-link" href="#remote-exec" title="Direct link to heading">â€‹</a></h3><p>Nos permite ejecutar comandos en los recursos que ya provisionamos.</p><p>Tenemos tres modos que podemos ejecutar comandos:</p><ul><li>inline </li><li>Script </li><li>Scripts </li></ul><p>Solo podemos usar un modo a la vez </p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_instance&quot; &quot;web&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    provisioner &quot;remote-exec&quot;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        inline = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;puppet apply&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;consul join ${aws_instance.web.private_ip}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Para poder hacer remote-exec necesitaremos un conection block</p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="conection-block">Conection block<a class="hash-link" href="#conection-block" title="Direct link to heading">â€‹</a></h3><p>Nos permite establecer una conexion desde nuestro recurso provisionado </p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_instance&quot; &quot;web&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    provisioner &quot;file&quot;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        source = &quot;conf/secrets.yaml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        destination = &quot;/etc/secrets.yaml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        connection {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            type = &#x27;ssh&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            user = &#x27;root&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            password = &quot;${var.password}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            host = &quot;${var.host}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="file-provisioner">File provisioner<a class="hash-link" href="#file-provisioner" title="Direct link to heading">â€‹</a></h3><p>Lo usamos para copiar archivos desde nuestra computadora a los
recursos que hemos provisionado</p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_instance&quot; &quot;web&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    provisioner &quot;file&quot;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        source = &quot;conf/secrets.yaml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        destination = &quot;/etc/secrets.yaml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Para poder hacer remote-exec necesitaremos un conection block</p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="null-resource">Null resource<a class="hash-link" href="#null-resource" title="Direct link to heading">â€‹</a></h3><p>Es una forma de no crear ningun recurso pero podemos ejecutar comandos
usando local-exec o usar triggers</p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;null_resource&quot; &quot;status&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    provider &quot;local-exec&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        command = &quot;echo ${self.private_ip}, $KEY, $SECRET &gt;&gt; private_ip.txt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    depends_on = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        aws_instance.my_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="providers">Providers<a class="hash-link" href="#providers" title="Direct link to heading">â€‹</a></h2><p>Son plugins que ayuda a terraform a poder interactuar con las distintos
proveedores de nube como AWS, GCP o Azure, etc.
Hay tres tipos de providers </p><ul><li>Official Publicado por la compaÃ±ia que tiene el servicio</li><li>Verified Altamente mantenido por el proveedor y terraform </li><li>Community Creado por la comunidad, no garantiza que este actualizado o mantenimiento.</li></ul><p><code>terraform init</code> nos ayuda a descargar los plugins y que podamos interactuar con los
proveedores.</p><p>Terraform registry es la nube publica de terraform donde podemos
encontrar los modulos y plugins publicos</p><p>Terraform cloud ayuda a publicar modulos privados de tu organizacion</p><p>Una forma de ver todos los providers de terraform es con </p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">terraform providers</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Tenemos una forma de decir los provedores</p><p>tambien podemos tener multiples providers con el alias </p><p>Tambien podemos setear un proveedor </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="modules">Modules<a class="hash-link" href="#modules" title="Direct link to heading">â€‹</a></h3><p>Los modulos son grupos de archivos de configuraciones que provee configuraciones comunes
al levantar infraestructura. </p><p><strong>Por que usar Modulos?</strong></p><ul><li>Buscan tener las mejores practicas </li><li>reduce la cantidad de codigo</li><li>Reduce el tiempo de desarrollo<div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Cuando usar terraform?
Podemos usar terraform cuando tenemos tareas que solo se hacen una vez, como
crear usuarios, crear bases de datos, agregar la data en la db</p></div></div></li></ul><p>Podemos usar ansible, cuando?
Tenemos tareas repetitivas como hacer un backeup o truncar data diaria </p><p>Usamos terraform registry para publicar nuestros modulos
:::</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Solo los modulos verificados aparecen en la barra de busqueda.</p></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="como-usar-modulos">Como usar modulos?<a class="hash-link" href="#como-usar-modulos" title="Direct link to heading">â€‹</a></h4><p>Tenemos modulos de tipo publico los cuales los encontramos en Terraform registry </p><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">module &quot;consul&quot;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sources = &quot;hashicorp/consul/aws&quot; #&lt;NAMESPACE&gt;/&lt;NAME&gt;/&lt;PROVIDER&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  version = &quot;1.0.2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Tenemos modulos de tipo privado los cuales los encontramos en terraform cloud(Enterprise)</p><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">module &quot;vpc&quot;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sources = &quot;app.terraform.io/example_corp/vpc/aws&quot; #&lt;HOSTNAME&gt;/&lt;NAMESPACE&gt;/&lt;NAME&gt;/&lt;PROVIDER&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  version = &quot;1.0.2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Para usar los modulos privados debemos autenticarnos usando <code>terraform login</code> en el terraform cloud
Tambien podemos usar un API_TOKEN y configurarlo en el cli</p></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="como-publicar-modulos">Como publicar modulos?<a class="hash-link" href="#como-publicar-modulos" title="Direct link to heading">â€‹</a></h4><p>Usamos terraform registry para publicar nuestro modulos publicos, ademas tenemos las siguientes ventajas:</p><ol><li>Versionamiento </li><li>Genera documentacion de forma automatica </li><li>Historial</li><li>READMES</li><li>Ejemplos </li></ol><p>Pasos para publicar un modulo
(Usamos github para almacenar el codigo de nuestros modulos)</p><ol><li>Nombrar nuestro repositorios deben ser nombrados de una forma particular
<code>terraform-&lt;PROVIDER&gt;-&lt;NAME&gt;</code>. </li><li>Logear en terraform registry con nuestra cuenta de github.</li><li>Seleccionar el repositorio </li></ol><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Para realizar actualizaciones a esos modulos usamos los tags de github. </p></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="modulos-verificados">Modulos verificados<a class="hash-link" href="#modulos-verificados" title="Direct link to heading">â€‹</a></h4><p>Todos los modulos verificados tienen un simbolo azul con un visto dentro.
Dichos modulos son mantenidos activamente por hashicorp y otros miembros
de la comunidad.</p><p>No necesariamente los modulos que no son verificados quieren decir que son malos.</p><ul><li>Existen modulos que no son verificados altamente mantenidos y con buenas features.</li><li>Existen modulos verificados que son solo buenos ejemplos.</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="estructura-de-los-modulos">Estructura de los modulos<a class="hash-link" href="#estructura-de-los-modulos" title="Direct link to heading">â€‹</a></h4><p><img alt="module-structure" src="/docs/assets/images/module-structure-65afc3458830286f469af5740ad65788.png"></p><ul><li>El punto de acceso es la carpeta root.</li><li>Tenemos 5 archivos requeridos (main.tf, variables.tf, outputs.tf, README, LICENSE).</li><li>En los modulos anidados debemos usar path absolutos y no relativos.</li><li>Los modulos anidados sin README son considerados para uso interno.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="data-sources">Data Sources<a class="hash-link" href="#data-sources" title="Direct link to heading">â€‹</a></h2><p>Es una forma que tiene terraform en conseguir informacion que este fuera de terraform
o de la computadora local </p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">data &quot;aws_ami&quot; &quot;example&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  most_recent = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  owners = [&quot;self&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name   = &quot;app-server&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tested = &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>de esta manera podemos ir a aws y buscar dicha especificacion y una vez la obtengamos
podemos usar dichos id para referenciar otros servicios de la siguiente manera</p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_instance&quot; &quot;web&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ami           = data.aws_ami.web.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance_type = &quot;t1.micro&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="resources-meta-arguments">Resources Meta Arguments<a class="hash-link" href="#resources-meta-arguments" title="Direct link to heading">â€‹</a></h2><p>Los resources representan objetos en nuestra infraestructura. ejemplo VM, DB, etc.
Algunos resources tienen un parametro <code>timeout</code> que nos sirve para definir el tiempo
en el que consideraremos si un recurso fallo al crearse.</p><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_db_instance&quot; &quot;example&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  timeouts {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    create = &quot;60m&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delete = &quot;2h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Podemos usar estos argumentos en cualquier recurso con el fin de cambiar
su comportamiento los mas comunes son:</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="depends-on">Depends on<a class="hash-link" href="#depends-on" title="Direct link to heading">â€‹</a></h3><p>con este argumento declaramos dependencia explicita entre recursos, es decir,
el uno necesita que el otro este ready para poder provisionarlo. </p><p>terraform hace esto de manera implicita pero hay momentos en lo ques la inferencia de
terraform no es suficiente y necesitamos ser mas explicito al momento de provisionar
recursos </p><p>ejemplo </p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_iam_role_policy&quot; &quot;example&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name   = &quot;example&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  role   = aws_iam_role.example.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  policy = jsonencode({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Statement&quot; = [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Action&quot; = &quot;s3:*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Effect&quot; = &quot;Allow&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_instance&quot; &quot;example&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ami           = &quot;ami-a1b2c3d4&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance_type = &quot;t2.micro&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Terraform can infer from this that the instance profile must</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # be created before the EC2 instance.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  iam_instance_profile = aws_iam_instance_profile.example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # However, if software running in this EC2 instance needs access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # to the S3 API in order to boot properly, there is also a &quot;hidden&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # dependency on the aws_iam_role_policy that Terraform cannot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # automatically infer, so it must be declared explicitly:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  depends_on = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aws_iam_role_policy.example,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="count">count<a class="hash-link" href="#count" title="Direct link to heading">â€‹</a></h3><p>para crear multiples replicas de un recursos basado en un valor </p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_instance&quot; &quot;server&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count = 4 # create four similar EC2 instances</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ami           = &quot;ami-a1b2c3d4&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance_type = &quot;t2.micro&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name = &quot;Server ${count.index}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Tambien podemos usar expresiones numericas </p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_instance&quot; &quot;server&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count = length(var.subnet_ids)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="for_each">for_each<a class="hash-link" href="#for_each" title="Direct link to heading">â€‹</a></h3><p>para crear multiples replicas acorde a un map o set, esto nos ayuda a crear
recursos de una forma mas dinamica </p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_resource_group&quot; &quot;rg&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for_each = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a_group = &quot;eastus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    another_group = &quot;westus2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name     = each.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location = each.value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Si queremos hacer lo mismo con un set </p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_iam_user&quot; &quot;the-accounts&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for_each = toset( [&quot;Todd&quot;, &quot;James&quot;, &quot;Alice&quot;, &quot;Dottie&quot;] )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name     = each.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>el each.value en los set seria <code>null</code> </p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="provider">provider<a class="hash-link" href="#provider" title="Direct link to heading">â€‹</a></h3><p>para seleccionar otro proveedor con esto podemos hacer diferentes despliegues en
multiples zonas o multiples nubes </p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># The default provider configuration; resources that begin with `aws_` will use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># it as the default, and it can be referenced as `aws`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">provider &quot;aws&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  region = &quot;us-east-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Additional provider configuration for west coast region; resources can</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># reference this as `aws.west`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">provider &quot;aws&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  alias  = &quot;west&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  region = &quot;us-west-2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ahora para usarlo en un recurso hacemos lo siguiente </p><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_instance&quot; &quot;foo&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  provider = aws.west</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="lifecycle">lifecycle<a class="hash-link" href="#lifecycle" title="Direct link to heading">â€‹</a></h3><p>para crear ciclos de vida custom y cambiar el comportamiento de los recursos </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="resources-behaviour">Resources Behaviour<a class="hash-link" href="#resources-behaviour" title="Direct link to heading">â€‹</a></h4><p>Hay 3 comportamientos o estados basicos en los recursos </p><ul><li><p><code>create</code> es cuando el recurso se encuentra definido en la configuracion pero
no existe infraestructura fisica atada a el. Asociado con un (+)</p></li><li><p><code>destroy</code> es cuando el recurso existe en el estado pero no en la configuracion.
Asociado con un (-)</p></li><li><p><code>update-in-place</code> es cuando los argumentos del recurso han sufrido modificaciones.
Asociado con un (~)</p></li><li><p><code>destroy and recreate</code> es cuando no podemos hacer una actualizacion del recursos
por limitaciones del api. Asociado con un (-/+)
</p></li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="lifecycle-blocks">Lifecycle blocks<a class="hash-link" href="#lifecycle-blocks" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg language-terraform theme-code-block"><div class="codeBlockContent_csEI terraform"><pre tabindex="0" class="prism-code language-terraform codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_resource_group&quot; &quot;example&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lifecycle {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    create_before_destroy = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>tiene varios argumentos los cuales son:</p><ul><li><p>create_before_destroy (bool): </p></li><li><p>prevent_destroy (bool):</p></li><li><p>ignore_changes (list of attributes): </p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="provisioners-1">Provisioners<a class="hash-link" href="#provisioners-1" title="Direct link to heading">â€‹</a></h3><p>para hacer funciones extras luego de crear el recurso </p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="terraform-expresions">terraform expresions<a class="hash-link" href="#terraform-expresions" title="Direct link to heading">â€‹</a></h2><p>Las expresiones nos ayudan a realizar calculo de valores sin configuraciones
previas.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="types-and-values">Types and values<a class="hash-link" href="#types-and-values" title="Direct link to heading">â€‹</a></h3><p>El resultado de una expresion es un valor y por ende tiene un tipo de dato </p><p>existen 3 grupos de tipos de datos:</p><ul><li>Primitives</li></ul><ol><li>string: son palabras o frases dentro de comillas dobles</li><li>number: pueden ser enteros o decimales</li><li>boolean: valores de verdad (True or False)</li></ol><ul><li>No type </li></ul><ol><li>null: no significa la ausencia de valor, por ende vendria a ser el valor por default de cada
proveedor y se usa la palabra reservada <code>null</code></li></ol><ul><li><a href="#complex-types">complex/structural</a></li></ul><ol><li>list </li><li>maps</li><li>objects</li><li>sets </li><li>tuples</li></ol><h3 class="anchor anchorWithStickyNavbar_y2LR" id="string-and-templates">String and templates<a class="hash-link" href="#string-and-templates" title="Direct link to heading">â€‹</a></h3><p>Por el momento terraform solo soporta comilla doble no comilla
simple esto es bueno porque podemos tener caracteres de escape
como por ejemplo:</p><ul><li><code>\n</code> Salto de lionea</li><li><code>\t</code> Tab</li><li><code>\r</code> Enter</li><li><code>\\</code> Backslash
Podemos tener un string de multiples lineas para esto terraform
maneja el <code>heredoc</code> style que es propio de los sistemas unix</li></ul><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;&lt;EOT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">world </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOT</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Siempre empezaremos con <code>&lt;&lt;</code> seguido de cualquier palabra en
mayusculas y cerramos el tag con la misma palabra en mayusculas
dentro de dicho tag todo lo que este sera considerado un string </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="string-interpolation">String Interpolation<a class="hash-link" href="#string-interpolation" title="Direct link to heading">â€‹</a></h4><p>Es la habilidad de evaluar una expresion entre llaves <code>${...}</code>
y convertirlo en un string </p><p>Ejemplo:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;Hola, ${var.name}!&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="string-directive">String directive<a class="hash-link" href="#string-directive" title="Direct link to heading">â€‹</a></h4><p>Permite evaluar condiciones logicas entre llaves <code>%{...}</code>, para
esto podemos usar interpolation de strings o HEREDOC. Con esto
podemos usar <code>for loops</code> o <code>if else</code></p><p>Ejemplo:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;&lt;EOT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%{ for ip in aws_instance.example.*.private_ip }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server ${ip}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%{ endfor }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOT</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="operators">Operators<a class="hash-link" href="#operators" title="Direct link to heading">â€‹</a></h3><p>Al igual que cualquier lenguaje de programacion tenemos operadores
estos pueden ser aritmetico o logicos </p><p>Aritmeticos:</p><ul><li>multiplicacion <code>a*b</code></li><li>division <code>a/b</code></li><li>suma <code>a + b</code></li><li>resta <code>a - b</code></li><li>residuo <code>a % b</code></li></ul><p>Condicionales:</p><ul><li>Igual <code>a==b</code></li><li>diferente <code>a!=b</code></li><li>menor <code>a&lt;b</code></li><li>menor igual <code>a&lt;=b</code></li><li>mayor <code>a&gt;b</code></li><li>mayor igual <code>a&gt;=b</code></li></ul><p>Logicos:</p><ul><li>Or <code>a||b</code></li><li>and <code>a&amp;&amp;b</code></li><li>not <code>!a</code></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="conditional-expressions">Conditional expressions<a class="hash-link" href="#conditional-expressions" title="Direct link to heading">â€‹</a></h3><p>Usamos el operador ternario <code>?</code> para hacer <code>if else</code></p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">condicion ? valor true : valor false</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Ejemplo </p><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">var.a != &quot;&quot; ? var.a : &quot;default-a&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Los valores que se retornan deben ser del mismo tipo, no puedo
retornar en el valor true un numero y en el falso un string</p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="for-expressions">For expressions<a class="hash-link" href="#for-expressions" title="Direct link to heading">â€‹</a></h3><p>Nos ayuda a iterar un tipo de dato complejo y aplicarle transformaciones.
Podemos recibir <code>listas, set, tuples, maps, objects</code></p><p>Si tenemos <code>[]</code> regresaremos una tupla
Si tenemos <code>{}</code> regresaremos un objeto</p><p>Para listas o sets </p><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[for s in var.list : upper(s)] ---&gt; [&quot;HELLO&quot;, &quot;WORLD&quot;]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">{for s in var.list : upper(s)} ---&gt; {hello = &quot;HELLO&quot;, world =&quot;WORLD&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Para map u objetos</p><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[for k, v in var.map : length(k) + length(v)]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>En las listas tambien podemos obtener el indice del elemento algo
similar a usar el metodo enumerate de python </p><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[for i, e in var.list : &quot;${i}, ${e}&quot; ]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Tambien podemos reducir la cantidad de elementos que retornamos en el for
usando un <code>if else</code></p><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[for e in var.list : upper(e) if e != &quot;&quot;]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="splat-expressions">Splat expressions<a class="hash-link" href="#splat-expressions" title="Direct link to heading">â€‹</a></h3><p>Es una forma corta de usar un bucle for. Esto lo hacemos usando el
splat operator <code>*</code></p><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[for o in var.list : o.id] -&gt; var.list[*].id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[for o in var.list : o.interface[0].name -&gt; var.list[*].interface[0].name]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="dynamic-blocks">Dynamic blocks<a class="hash-link" href="#dynamic-blocks" title="Direct link to heading">â€‹</a></h3><p>Nos ayuda a construir bloques de codigo anidados que se repetiran a lo
largo de nuestro codigo de terraform, debemos usar la palabra reservada
<code>dynamics</code> y actuara como un bucle for</p><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_elastic_beanstalk_environment&quot; &quot;tfenvtest&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                = &quot;tf-test-name&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  application         = &quot;${aws_elastic_beanstalk_application.tftest.name}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  solution_stack_name = &quot;64bit Amazon Linux 2018.03 v2.11.4 running Go 1.12.6&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dynamic &quot;setting&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for_each = var.settings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      namespace = setting.value[&quot;namespace&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name = setting.value[&quot;name&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      value = setting.value[&quot;value&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="version-constraints">Version constraints<a class="hash-link" href="#version-constraints" title="Direct link to heading">â€‹</a></h3><h2 class="anchor anchorWithStickyNavbar_y2LR" id="terraform-state">Terraform state<a class="hash-link" href="#terraform-state" title="Direct link to heading">â€‹</a></h2><p>Que es un estado ?</p><p>Un estado es una condicion particular en el que estan los recursos en la nube
en un periodo de tiempo</p><p>Como terraform preserva el estado?</p><p>Cuando provisonamos recursos en la nube, terraform crea un archivo de estado
llamado <code>terraform.tfstate</code>, este archivo es un json y contiene un mapeo 1 a 1
de los recursos de instancia con los recursos en la nube </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="comandos">Comandos<a class="hash-link" href="#comandos" title="Direct link to heading">â€‹</a></h3><ul><li><code>terraform state list</code>: lista los resources en el state</li><li><code>terraform state mv</code>: Mueve o cambia de nombre un elemento del estado </li><li><code>terraform state pull</code>: Se baja el remote state y lo imprime en consola </li><li><code>terraform state push</code>: actualiza el remote state con el local state </li><li><code>terraform state replace-provider</code>: Cambia el provider del state</li><li><code>terraform state rm</code>: elimina recursos del state</li><li><code>terraform state show</code>: Muestra un recurso del state</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="terraform-state-mv">terraform state mv<a class="hash-link" href="#terraform-state-mv" title="Direct link to heading">â€‹</a></h3><p>Si solo le cambiamos el nombre a un recurso o lo movemos a un modulo
al aplicar terraform apply. terraform destruira el recurso y lo generara de nuevo
sino queremos que esto pase podemos usar terraform state mv para renombrar
el recurso sin la accion de borrarlo y recrearlo.</p><p>Para renombrar </p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">terraform state </span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> packet_device.worker packer_devices.helper</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Para mover un recurso a un modulo </p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">terraform state </span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> packet_device.worker module.worker.packet_devices.worker</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Para mover un modulo dentro de un modulo</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">terraform state </span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> module.app module.parent.module.app</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="terraform-state-backups">terraform state backups<a class="hash-link" href="#terraform-state-backups" title="Direct link to heading">â€‹</a></h3><p>Todos los subcomandos de terraform state que modifican el estado
crearan un archivo backup. <code>list y show</code> como solo leen no crean un backup
este archivo se llamada <code>terraform.tfstate.backup</code>. POr buenas practicas siempre
se creara un archivo de tipo backup.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="debugging-and-troubleshooting">debugging and troubleshooting<a class="hash-link" href="#debugging-and-troubleshooting" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="debugging">Debugging<a class="hash-link" href="#debugging" title="Direct link to heading">â€‹</a></h3><p>Como cualquier otra tool de codigo, tendremos ocasiones donde queremos debuguear
nuestros archivos o necesitamos probar funcionalidades para esto terraform tiene
3 comandos bastante utiles. </p><ul><li><p><code>terraform fmt</code> Re-escribe los archivos de configuraciones cumpliendo el formato y
estilo propio de terraform. Una opcion mas verbosa para ver que archivos se modificaron
es usar <code>terraform fmt --diff</code></p></li><li><p><code>terraform validate</code> Valida la sintaxis y los argumentos de los archivos. es decir, si
a un modulo le hace falta que le pasemos un parametro. Esto no valida que el argumento que
pasemos sea valido, es decir, debo pasarle un string y le paso <code>dasdads</code> solo valida que
sea un string no su contenido.</p></li><li><p><code>terraform console</code> Una shell interativa para evaluar expresiones.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="troubleshooting">Troubleshooting<a class="hash-link" href="#troubleshooting" title="Direct link to heading">â€‹</a></h3><p>En terraform tenemos 4 tipo de errores principales los cuales son:</p><ol><li>Language errors: Syntax error</li><li>State errors: El estado de nuestros recursos fue cambiada del estado esperado</li><li>Core errors: Bug en la libreria core</li><li>Provider errors: La api del proveedor cambio y debemos hacer cambios</li></ol><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>las dos primeras son super sencillas de resolver, mientras que las dos ultimas son
dificiles de resolver.</p><p>Para la primera podemos usar <code>terraform fmt</code>, <code>validate</code>, <code>version</code>
Para la segunda podemos usar <code>terraform refresh</code>
Para las dos ultimas podemos usar los logs para obtener info <code>TF_LOG</code> y abrir un issue
en github</p></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="logs">Logs<a class="hash-link" href="#logs" title="Direct link to heading">â€‹</a></h4><p>Podemos activar los logs de terraform usan las variables de entorno <code>TF_LOG environment</code>
Para environment tenemos los siguientes valores:</p><ul><li>TRACE</li><li>DEBUG </li><li>INFO</li><li>WARN</li><li>ERROR</li><li>JSON</li></ul><p>Podemos habilitarlo de forma separada usando :</p><ul><li><code>TF_LOG_CORE</code></li><li><code>TF_LOG_PROVIDER</code></li></ul><p>Para modificar el path donde se guardan los logs podemos usar la variable <code>TF_LOG_PATH</code></p><p>Estos comando los pasamos por ejemplo antes del comando <code>terraform apply</code>.
Ejemplo</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">TF_LOG</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">CORE </span><span class="token assign-left variable" style="color:#36acaa">TF_LOG_PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">./terraform.log terraform apply </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="crash-log">Crash Log<a class="hash-link" href="#crash-log" title="Direct link to heading">â€‹</a></h4><p>terraform utiliza por detras el lenguaje de programacion go y las go rutines para que
cuando pase algo se ejecute dicho evento de panico y guarde un archivo de logs. Esto nos
sera util para crear el issue en github.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="notas-importantes">Notas importantes<a class="hash-link" href="#notas-importantes" title="Direct link to heading">â€‹</a></h2><p>Algunas notas sobre los comandos mas en detalle.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="terraform-init">terraform init<a class="hash-link" href="#terraform-init" title="Direct link to heading">â€‹</a></h3><p>Inicializa nuestro proyecto de terraform realizando:</p><ul><li><p>La descarga de los plugins.</p></li><li><p>crea un directorio de terraform <code>.terraform</code>. </p></li><li><p>crea un archivo de dependencias con el fin de forzar que todos tengan las mimas
versiones.</p></li><li><p><code>terraform init -upgrade</code></p></li><li><p><code>terraform init -get-plugins-false</code></p></li><li><p><code>terraform init -plugin-dir=$PATH</code></p></li><li><p><code>terraform init -lockfile=MODE</code></p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="terraform-get">Terraform get<a class="hash-link" href="#terraform-get" title="Direct link to heading">â€‹</a></h3><p>Es parecido al <code>terraform init</code> con la diferencia que buscamos actualizar
modulos locales o descargarnos los ultimos cambios de dichos modulos. No queremos
nuevas actualizaciones de proovedores o cambiar el estado por eso no usamos
<code>terraform init</code></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="terraform-plan">Terraform plan<a class="hash-link" href="#terraform-plan" title="Direct link to heading">â€‹</a></h3><p>Crea un <code>execution plan</code> el cual es un archivo binario. Un <code>execution plan</code> consiste en:</p><ul><li><p>Lee el estado remoto de los objetos con el fin de asegurarse que el estado este al dia </p></li><li><p>Compara las configuraciones con el fin de pdoer notar los cambios.</p></li><li><p>Propone un set de cambios que se deberian aplicar para que ambas configuraciones esten iguales.</p></li></ul><p>Este comando no ejecuta los cambios, solo los propone.</p><p>Existen dos tipos de plan:</p><ol><li><p>Planes especulativos cuando ejecutamos <code>terraform plan</code> </p></li><li><p>Planes guardados: podemos guardar nuestros planes de ejecucion usando el flag <code>--out</code> de la
siguiente manera <code>terraform plan --out=mi-plan.plan</code>. </p></li></ol><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li>No hay name conventions para los nombres que usamos para guardar nuestros planes</li><li>Suele ser util en pipelines de CI/CD</li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="terraform-apply">Terraform apply<a class="hash-link" href="#terraform-apply" title="Direct link to heading">â€‹</a></h3><p>Ejecuta los cambios propuestos en el <code>execution plan</code></p><p>Como tenemos dos tipos de planes tambien tenemos dos tipos de terraform apply </p><ol><li><p>Usando Automatic plan Mode.  Ejecutamos <code>terraform apply</code> automaticamente aplica el validate,
crea el plan y lo ejecuta. En este modo si necesitaremos una aprobacion para ejecutar dicho plan.</p></li><li><p>Saved plan mode. Ejecutamos <code>terraform apply FILE</code> automaticamente se crean los cambios
con el plan de execution que le enviamos.</p></li></ol><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Para inspeccionar el plan podemos usar <code>terraform show</code></p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="drift">Drift<a class="hash-link" href="#drift" title="Direct link to heading">â€‹</a></h2><p>Esto ocurre cuando nuestros recursos esperados estan en un estado diferente
a nuestro estado esperado.</p><p>Hay 3 formas de resolver dicho conflicto:</p><ul><li>Remplazando recursos. Esto ocurre cuando un recurso esta daÃ±ado y terraform no lo reconoce.
Usamos el flag <code>--replace</code>. Antes usabamos <code>terraform taint</code> para marcar los recursos que en un futuro
quedaran deprecated. Pero desde la version <code>0.152</code> este comando esta deprecated.</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Con el comando <code>terraform apply --replace=&quot;aws_instance.my_ec2[0]&quot;</code>. solo podemos un
recurso a la vez</p></div></div><ul><li>Importando recursos. Cuando un recurso lo queremos agregar de forma manual al estado. Usamos
el <code>--import</code></li></ul><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_instance&quot; &quot;example&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # ... instance configuration ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>con esto al usar <code>terraform import aws_instance.example [id]</code> importamos un recurso que creamos de
forma manual en la consola. </p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><ul><li>No todos los recursos puden ser importados automaticamente al state file. Deberiamos revisar
la documentacion para saber que recursos si tienen este feature.</li><li>Solo podemos importar un recurso a la vez</li></ul></div></div><ul><li>Actualizando el estado. Lee la configuracion actual de todos los recursos remotos y actualiza
el estado para los cambios. Sin realizar cambios en nuestra infraestructura remota.</li></ul><p>Podemos usar <code>terraform refresh</code> el cual es un alias para   <code>terraform apply --auto-approve --refresh-only</code></p><p>Consideremos el siguiente escenario para que se entienda mejor.</p><p>Creamos un script para que provisione una maquina virtual en aws. A uno de nuestros ingenieros le decimos
que elimine la maquina virtual y el en vez de modificar el script lo elimina directo de la consola. </p><p>Si ejecutamos terraform apply. </p><ol><li>Asumira que el estado es correcto,que nos hace falta una maquina virtual </li><li>Propondra provisionar una vm </li></ol><p>Si ejecutamos <code>terraform apply --refresh-only</code></p><ol><li>Se dara cuenta que la maquina virtual que creamos falta </li><li>Se dara cuenta que el evento que la maquina virtual no este es aproposito.</li><li>propondra cambiar el estado y no creara una maquina virtual.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="workflows">Workflows<a class="hash-link" href="#workflows" title="Direct link to heading">â€‹</a></h2><p>Las 3 fases basicas son:</p><ol><li>Escribir -&gt; Escribir la infraestructura que vamos a provisionar</li><li>Plan -&gt; Crear el plan de ejecucion</li><li>Apply -&gt; Provisionar infraestructura</li></ol><p>A medida que los grupos van creciendo los workflows deben ir evolucionando
tenemos 3 tipos de workflows a medida que los equipos van creciendo</p><ul><li>Indivual </li><li>Equipos que usan solo terraform </li><li>Equipos que usan terraform cloud</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="individuales">Individuales<a class="hash-link" href="#individuales" title="Direct link to heading">â€‹</a></h3><ul><li>Escribir </li></ul><ol><li>Escribimos nuestros archivos de terraform en cualquier editor de texto </li><li>Guardamos nuestros cambios usando VCS (Version control system) como git</li><li>Usamos de forma repetitiva <code>terraform plan</code> y <code>terraform validate</code> para
no tener errores de sintaxis</li></ol><ul><li>Plan</li></ul><ol><li>Cuando ya no tenemos errores hacemos un commit local</li><li>Solo usaremos una rama <code>main</code></li><li>Cuando terminamos el proceso de commit pasamos al apply</li></ol><ul><li>Apply</li></ul><ol><li>Ejecutamos <code>terraform apply</code></li><li>Revisamos el plan de ejecucion </li><li>Luego de que los cambios se hayan provisionado de forma exitosa hacemos un push
a nuestro repositorio remoto.</li></ol><h3 class="anchor anchorWithStickyNavbar_y2LR" id="equipos">Equipos<a class="hash-link" href="#equipos" title="Direct link to heading">â€‹</a></h3><ul><li>Escribir </li></ul><ol><li>Cada equipo escribe su codigo de forma local con su editor favorito</li><li>Se crean ramas por equipo con el fin de poder manejar los conflictos </li><li>Terraform plan puede ser un buen feedback para equipos pequeÃ±os</li><li>Para equipos mas largos las credenciales empiezan a ser un problema por ende
usar un pipeline de CI/CD es lo mejor</li></ol><ul><li>Plan</li></ul><ol><li>Cuando una rama esta lista procedemos a realizar el PR el cual generara el plan
de ejecucion que lo adjuntamos en el PR para revision</li></ol><ul><li>Apply</li></ul><ol><li>Una vez aprobado y mergeado el PR se procede a ejecutar el pipeline el mismo que
ejecutara el <code>terraform apply</code></li></ol><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>s </h5></div><div class="admonition-content"><ul><li>El equipo de devops debe mantener y modificar los pipelines de CI/CD</li><li>Se debe pensar como almancenar el <code>state file</code></li><li>No podemos tener control de accesos o permisos, es decir, quien puede destruir
recursos, quien puede aplicarlos, etc.</li><li>Debemos gestionar como inyectar secrets de una forma segura</li><li>Manejar multiples ambientes puede ser algo caotico.</li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="equipos-usando-terraform-cloud">Equipos usando terraform cloud<a class="hash-link" href="#equipos-usando-terraform-cloud" title="Direct link to heading">â€‹</a></h3><ul><li>Escribir </li></ul><ol><li>usaremos terraform cloud como nuestro backend remoto</li><li>Las variables las almacenamos en terraform cloud y no en nuestro computadora
usando archivos <code>.tfvars</code></li><li>terraform cloud tiene integraciones con los VCS y automaticamente crea los pipelines</li><li>Escribir el codigo de cada equipo en diferentes ramas.</li></ol><ul><li>Plan </li></ul><ol><li>Cuando una rama esta lista procedemos a realizar el PR el cual generara el plan
de ejecucion que lo adjuntamos en el PR lo podemos revisar y comentar usando terraform cloud</li></ol><ul><li>Apply </li></ul><ol><li>Luego del PR sea mergeado terraform cloud ejecutara el apply. Una persona del equipo debe confirmar
dichos cambios.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="backends">Backends<a class="hash-link" href="#backends" title="Direct link to heading">â€‹</a></h2><p>Define donde y como las operaciones se ejecutan, ademas donde almacenamos las snapshots.</p><p>Existen dos tipos de terraform backends:</p><ol><li>Standard backend</li></ol><ul><li>solo almacena los estados</li><li>No podemos realizar operaciones como <code>terraform apply</code></li><li>Son backends de terceros como aws s3</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Algunas opciones de backends de terceros son:</p><ul><li>S3 podemos lockear usando DynamoDB</li><li>Azure blob storage lockeamos de forma integrada</li><li>Google cloud storage lockeo de forma integrada</li><li>Alibaba cloud object storage services lockear usando TableStore</li><li>OpenStack Swift lockeo integrado</li><li>Tencent cloud object storage lockeo integrado</li><li>Manta lockeo integrado</li></ul><p>Podemos usar servicios mas extravagantes </p><ul><li>Hashicorp consul </li><li>etcd</li><li>postgresdb</li><li>kubernetes secrets</li><li>artifactory no tiene lockeo</li></ul></div></div><ol start="2"><li>Enhanced backends </li></ol><ul><li>Podemos almacenar el estado </li><li>Ejecutar comandos como <code>terraform apply</code>
Tenemos 2 tipos:</li><li>Local: Archivos son guardados en la maquina local donde ejecutamos comandos.</li><li>Remote: Archivos e informacion es almacenada en la nube.</li></ul><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Los backups solo se guardan en la maquina local no en el backend remoto</p></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li>no necesitamos una cuenta de terraform cloud para crear remote backends</li><li>si usamos un remote backend necesitamos configurar las credenciales de CSP</li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="inicializacion-del-backend">Inicializacion del Backend<a class="hash-link" href="#inicializacion-del-backend" title="Direct link to heading">â€‹</a></h3><p>Podemos usar un archivo con la configuracion del backend con el fin de ponerlo en un
gitignore y que en nuestros repositorios no exista configuracion acerca de nuestro repositorios.</p><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">main.tf</div><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  required_version = &quot;~&gt; 2.0.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  backend &quot;remote&quot; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">backend.hcl</div><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">workspace = {name = &quot;workspace&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hostname = &quot;app.terraform.io&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">organization = &quot;company&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Podemos usar el flag <code>-backend-config</code> para pasar dicho archivo de configuracion</p><p>ejemplo </p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">terraform init --backend-config backend.hcl</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="terraform_remote_state">terraform_remote_state<a class="hash-link" href="#terraform_remote_state" title="Direct link to heading">â€‹</a></h3><p>Podemos obtener los outputs de otros archivos de estado por medio del data source
<code>terraform_remote_state</code> el cual usa el ultimo snapshot del estado de la infraestructura.</p><p>Para backend remotos</p><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data &quot;terraform_remote_state&quot; &quot;vpc&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  backend = &quot;remote&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    organization = &quot;hashicorp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    workspaces = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name = &quot;prod&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_instance&quot; &quot;example&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subnet_id = data.terraform_remote_state.vpc.outputs.subnet_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Solos los outputs del modulo root seran expuestas, si tenemos modulos anidados
debemos explicitamente exponerlas tambien en el moodulo root, sino no podremos acceder</p></div></div><p>Para backend locales </p><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data &quot;terraform_remote_state&quot; &quot;vpc&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  backend = &quot;local&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path = &quot;...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_instance&quot; &quot;example&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subnet_id = data.terraform_remote_state.vpc.outputs.subnet_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>usando los backend locales debemos pasarle la ruta absoluta del archivo de estado
Podemos usar data sources como alternativa al <code>terraform_remote_state</code> pero
recordemos que tendremos mas informacion sobre el recurso esto incluye informacion sensible</p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="bloqueo-del-estado">Bloqueo del estado<a class="hash-link" href="#bloqueo-del-estado" title="Direct link to heading">â€‹</a></h3><p>terraform de forma automatica bloquea el estado cada que se ejecuta una operacion
de escritura. Esto ayuda a que no se pueda corromper el estado cada que otros lo usen.</p><p>Terraform nos dara un output message si se demora el proceso de locking del state file.</p><p>Para desabilitar el bloqueo en los comandos que usamos utilizamos el flag <code>--lock</code> pero
no es recomendado</p><p>Tambien tenemos una forma de desbloquear de un state file con el comando
<code>terraform force-unlock</code>. Si desbloqueamos el archivo mientras alguien lo esta utilizando
causamos que multiples personas modifiquen dicho archivo. Debemos usar este comando
en las ocasiones cuando el desbloque automatico falla por cualquier razon. En estas situaciones
terraform imprimira por consola un id el cual usaremos en el comando de la siguiente forma </p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">terraform force-unlock </span><span class="token number" style="color:#36acaa">129239123921</span><span class="token plain">-ada231adsa-23123asdasd --force</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>con el flag <code>--force</code> skipeamos la confirmacion de lockeo.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="proteger-informacion-sensible">Proteger informacion sensible<a class="hash-link" href="#proteger-informacion-sensible" title="Direct link to heading">â€‹</a></h3><p>Los archivos de estado de terraform puden contener informacion sensible como contraseÃ±as, usuarios,
ips, etc. Causando posibles ataques y robo de informacion.</p><p>Cuando usamos local state debemos tener las siguientes consideraciones</p><ul><li>No debemos compartir dicho archivo con nadie </li><li>Debemos agregar dicho archivo en el .gitignore </li></ul><p>Cuando usamos remote state debemos tener las siguientes consideraciones</p><ul><li>Este archivo se guarda en memoria y no en disco</li><li>Este archivo esta encrypted-at-rest</li><li>Este archivo esta encrypted-at-transit</li></ul><p>:::cation
Si usamos almacenamiento de tercero debemos tener en cuenta si cumple con las politicas de seguridad
correspondientes para que nuestra informacion este segura y si esta activada por default.
:::</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ignore-files">Ignore files<a class="hash-link" href="#ignore-files" title="Direct link to heading">â€‹</a></h3><p>Es muy parecido a la funcionalidad del <code>.gitignore</code> con la diferencia que terraform
solo leera el archivo que esta en el root module, es decir, no sirve de nada tener varios archivos
<code>.terraformignore</code> en los diferentes sub-modulos porque no seran leidos.</p><p>Por defecto sino tenemos ningun archivo <code>.terraformignore</code>. terraform excluira los siguientes directorios:</p><ul><li><code>.git/</code></li><li><code>.terraform/</code></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="complex-types">Complex Types<a class="hash-link" href="#complex-types" title="Direct link to heading">â€‹</a></h2><p>Un complex type es un tipo de dato que agrupa multiples datos en uno.</p><p>Complex types los representamos por un constructor algunos tienen
tienen una palabra reservada.</p><p>Tenemos dos categorias para estos tipos de datos:</p><ul><li>Collection types (para agrupar valores similares)<ul><li>list, map y set</li></ul></li><li>Structural types (para agrupar valores que pueden no ser similares)<ul><li>tuple y object</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="collection-types">Collection types<a class="hash-link" href="#collection-types" title="Direct link to heading">â€‹</a></h3><p>Este tipo de dato nos ayuda a agrupar multiples valores del mismo tipo
en un solo valor.</p><p>Tenemos 3 tipos de collection types:</p><ul><li>List: es como el tipico array y podemos usar index para acceder a los elementos.
Todos los datos dentro del list deben ser del mismo tipo</li></ul><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;planet&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = list </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default = [&quot;mars&quot;, &quot;earth&quot;, &quot;moon&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">planet = var.planet[0]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Map es como el tipico diccionario de python o JSON object,
usamos la key para acceder al valor</li></ul><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;plans&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;PlanA&quot; = &quot;10 USD&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;PlanB&quot; = &quot;20 USD&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plan = var.plans[&quot;PlanA&quot;]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Sets: una colecciÃ³n de valores Ãºnicos que no tienen ningÃºn
identificador secundario u ordenaciÃ³n. Como todos los elementos
deben ser del mismo tipo, se castean con el tipo de dato
del primer elemento.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="structural-types">Structural types<a class="hash-link" href="#structural-types" title="Direct link to heading">â€‹</a></h3><p>Este tipo de dato nos ayuda a agrupar multiples valores de diferentes tipos
en un solo valor.
Requieren un schema como argumento con el fin de especificar que tipo de valores
van en cada elemento.</p><p>Tenemos dos tipos de structural types</p><ul><li>Objects es como un JSON con multiples tipos de valores</li></ul><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;plans&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = object({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PlanA = string,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PlanB = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;PlanA&quot; = &quot;10 USD&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;PlanB&quot; = &quot;20 USD&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plan = var.plans[&quot;PlanA&quot;]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Tuples es como una lista dinamica</li></ul><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;planet&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = tuple([string, number, bool]) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default = [&quot;mars&quot;, 1, false]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">planet = var.planet[0]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Podemos usar comas como simplemente salto de linea en los maps y objects.
Necesitamos el schema para los structural types</p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="built-in-functions">Built-in Functions<a class="hash-link" href="#built-in-functions" title="Direct link to heading">â€‹</a></h2><p>Son funciones que vienen propias de terraform que nos permite
realizar transformaciones o combinar valores</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="numeric">Numeric<a class="hash-link" href="#numeric" title="Direct link to heading">â€‹</a></h3><ul><li>abs(num): retorna el valor absoluto del num</li><li>floor(num): redondea hacia abajo el num</li><li>log(num, base): retorna el logaritmo del num en la base </li><li>ceil(num): redondea hacia arriba el num</li><li>min(set[]): retorna el minimo valor del set</li><li>max(set[]): retorna el maximo valor del set</li><li>parseint(num:string, base:int): parsea a int el string numero en la base que le digamos</li><li>pow(num, exp): calcula el valor de num a la exp</li><li>signum(num): representa el signo del numero (-1, 0, 1)</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="string">String<a class="hash-link" href="#string" title="Direct link to heading">â€‹</a></h3><ul><li>chomp(string): remueve los salto de lineas en los string</li><li>format(string, value): como el format de python para agregar variables al string</li><li>formatlist(string, valuelist): como el anterior pero con una lista de valores</li><li>indent(spaces, string): agrega la identacion </li><li>join(delimiter, list(string)): une todos los elementos de un array usando el delimiter
en un solo string</li><li>lower(string): regresa todo en minusculas del string </li><li>regex(regex, string): aplica una expresion regular a un string y devuelve los substrings</li><li>replace(phrase, stringReplace, newString): reemplaza el stringReplace por el newString en el phrase</li><li>split(delimeter, string): transforma el string en un array, usa el delimiter para saber el inicio
y fin de cada elemento</li><li>strrev(string): el reverso del string</li><li>substr(string, from, to) slice de un string desde from hasta to </li><li>title(string): capitaliza un string es decir convierte en mayusculas la primera letra de cada palabra</li><li>trim(string, delimiter): elimina el delimiter del string al inicio y al final</li><li>trimprefix(string, delimiter): elimina el delimiter del inicio</li><li>trimsuffix(string, delimiter): elimina el delimiter del final</li><li>trimspace(string): elimita todos los whitespaces</li><li>upper(string): pone en mayuscula un string</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="collection">Collection<a class="hash-link" href="#collection" title="Direct link to heading">â€‹</a></h3><ul><li>alltrue(list) retorna true si todos los elementos son true o si es una collection vacia sino retorna false</li><li>anytrue(list) retorna true si existe algun true sino retorna false</li><li>chunklist(list, size) retorna una lista de lista, crea agrupaciones de elementos de un tamaÃ±o establecido</li><li>coalesce(list) retorna el primer valor que no es null o un string vacio</li><li>coalescelist(list1, list2, list3) retorna la primera lista que no sea vacia</li><li>compact(list) retorna una lista sin string vacios </li><li>concat(list1, list2) retorna la fusion de dos listas en una</li><li>contains(list, element) retorna true si la lista contiene el elemento caso contrario false</li><li>distinct(list) retorna una lista sin los duplicados, solo con los elementos unicos</li><li>element(list, index) retorna el elemento en la posicion index de la lista</li><li>index(list, element) retorna el index del element de la lista</li><li>flatten(list) retorna una lista sin toda la listas anidadas</li><li>length(list) retorna la cantidad de elementos de la lista </li><li>keys(map) retorna una lista con las claves del map</li><li>lookup(map, key, default) retorna el valor de la key sino lo encuentra devuelve default</li><li>matchkeys(list1, list2, list3) retorna una lista con los elementos que se repiten</li><li>merge(maps) retorna un solo map con todos los maps que le pasamos por argumentos fusionados en uno solo.</li><li>one(list) retorna el primer elemento de una lista</li><li>range(number) genera una lista de numeros consecutivos usando el number como limite</li><li>reverse(list) genera una lista con el orden reverso</li><li>setintersection() retorna una lista con la interseccion </li><li>setproduct() retorna una lista con toda las posibles combinaciones de los elementos dentro </li><li>setsubtract() retorna los elementos que no tengan en comun de varias listas</li><li>setunion() retorna una lista de todos los elementos </li><li>sort() retorna un array ordenado de forma lexicographically</li><li>slice() slice de un array</li><li>sum() retorna la suma de los elementos de una lista</li><li>values(map) retorna una lista con los valores del map</li><li>zipmap(keysList, valuesList) retorna un map con las claves y lo valores en sus listas respectivas</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="encoding">Encoding<a class="hash-link" href="#encoding" title="Direct link to heading">â€‹</a></h3><ul><li>base64encode(string) retorna un string en base64</li><li>jsonencode(string) retorna un string en json</li><li>yamlencode(string) </li><li>textencodebase64</li><li>base64gzip()</li><li>urlencode() </li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="decoding">Decoding<a class="hash-link" href="#decoding" title="Direct link to heading">â€‹</a></h3><ul><li>base64decode(string) retorna un string decodeado</li><li>csvdecode()</li><li>jsondecode()</li><li>textdecodebase64()</li><li>yamldecode()</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="filesystem">Filesystem<a class="hash-link" href="#filesystem" title="Direct link to heading">â€‹</a></h3><ul><li>abspath(path.root) me devuelve el path absoluto de un path relativo</li><li>dirname(&quot;foo/bar/baz.txt&quot;) devuelve la carpeta o el direction elimina el archivo</li><li>pathexpand() devuelve el path absolut</li><li>basename() devuelve el nombre del archivo dado un path</li><li>file() lee el contenido de un archivo</li><li>fileexists() determina si un archivo existe</li><li>fileset() retorna una lista con los paths de los archivos que solicite</li><li>filebase64() retorna el valor del archivo en base64 bueno para imagenes</li><li>templatefile() retorna una lista con los valores del archivo de configuracion</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="date-and-time">Date and time<a class="hash-link" href="#date-and-time" title="Direct link to heading">â€‹</a></h3><ul><li>formatdate() formateamos una fecha UTC en el formato que queramos</li><li>timeadd() agregamos tiempo a una hora</li><li>timestamp() retorna el tiempo en UTC</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="hash-and-cripto">Hash and Cripto<a class="hash-link" href="#hash-and-cripto" title="Direct link to heading">â€‹</a></h3><ul><li>base64sha256()</li><li>base64sha512()</li><li><strong>bcrypt()</strong></li><li>filebase64sha256()</li><li>filebase64sha512()</li><li>filemd5()</li><li>filesha1()</li><li>filesha256()</li><li>filesha512()</li><li><strong>md5()</strong></li><li>rsadecrypt()</li><li><strong>sha1()</strong></li><li>sha256()</li><li>sha512()</li><li><strong>uuid()</strong></li><li>uuidv5()</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ip-network">Ip network<a class="hash-link" href="#ip-network" title="Direct link to heading">â€‹</a></h3><ul><li>cidrhost()</li><li>cidrnetmask()</li><li>cidrsubnet()</li><li>cidrsubnets()</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="type-conversion">Type conversion<a class="hash-link" href="#type-conversion" title="Direct link to heading">â€‹</a></h3><ul><li>can() retorna true si el valor existe</li><li>defaults()</li><li>nonsensitive() a un valor sensible lo trata como no sensible</li><li>sensitive() trata a un valor como sensible</li><li>tobool() convierte un valor en boolean</li><li>tomap() convierte un valor en un map</li><li>toset() convierte un valor en un set</li><li>tolist() convierte un valor en una lista</li><li>tonumber() convierte un valor en un numero</li><li>tostring() convierte un valor en un string</li><li>try()</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="terraform-cloud">Terraform cloud<a class="hash-link" href="#terraform-cloud" title="Direct link to heading">â€‹</a></h2><p>Terraform cloud es una plataforma que ayuda a los equipos a usar terraform
tiene las siguientes features:</p><ul><li>Manejo de los state files </li><li>historial de ejecucion de pipelines</li><li>historial de estados previos</li><li>inyeccion de variables facil y seguro</li><li>tageo</li><li>triggers</li><li>workspace</li><li>compartir el estado de forma global</li><li>comentar en la ejecucion del pipeline</li><li>Niveles de permisos como en gcp</li><li>Notificaciones via slack, email, etc.</li><li>Policy as code usando sentinel</li><li>MFA</li><li>Estimacion de costos </li><li>Multiples integraciones</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="terminos">Terminos<a class="hash-link" href="#terminos" title="Direct link to heading">â€‹</a></h3><ul><li>Organization: es el conjunto de workspaces</li><li>Workspace: es un ambiente unico </li><li>Teams: se componene por multiples miembros y puede acceder a diferentes workspace</li><li>Runs: ejecucion del execution plan en un ambiente virtual</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="run-workflows">Run workflows<a class="hash-link" href="#run-workflows" title="Direct link to heading">â€‹</a></h3><p>tenemos 3 tipos:</p><ol><li>Version control workflow se produce cuando ejecutamos un PR en github o hacemos un merge</li><li>CLI-driven cuando de forma local ejecutamos comandos como terraform apply</li><li>API-driven usando el api de terraform </li></ol><h3 class="anchor anchorWithStickyNavbar_y2LR" id="organizational-level-permissions">Organizational Level permissions<a class="hash-link" href="#organizational-level-permissions" title="Direct link to heading">â€‹</a></h3><p>Podemos configurar para que todas las personas dentro de una organizacion puedan
hacer lo siguiente:</p><ul><li>Manejar politicas</li><li>Manejar el sobreescrimiennto de las politicas</li><li>manejar workspace</li><li>manejar VCS settings</li></ul><p>Existe un rol especial dentro de las organizaciones que son los owners.
Una organizacion puede tener uno o mas owners.
Los permisos especiales que tenemos con este rol son:</p><ul><li>Publicar modulos privados </li><li>Invitar usuarios a la organizacion </li><li>manejar la membresia de los equipos </li><li>ver todos los secrets del team </li><li>manejar permisos de la organizacion </li><li>manejar la facturazion de la organizacion </li><li>eliminar organizacion </li><li>manejar las configuraciones de la organizacion</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="workspace-level-permissions">Workspace Level permissions<a class="hash-link" href="#workspace-level-permissions" title="Direct link to heading">â€‹</a></h3><p>Manejar los recursos y las configuraciones de los workspaces</p><p>Tenemos permisos en una forma mas granular (custom permission):</p><ul><li>leer runs</li><li>encolar plans </li><li>correr run</li><li>bloquear y desbloquear workspaces</li><li>descargar sentinel mocks</li><li>leer una variable </li><li>escribir variables</li><li>leer outputs del estado </li><li>leer versiones del estado </li></ul><p>Tenemos tambien grupos de de permisos preestablecidos:</p><ul><li>Write</li><li>Plan </li><li>Read</li></ul><p>Asi como en las organizaciones tenemos un owner en los workspaces
tenemos los admins.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="api-token">Api Token<a class="hash-link" href="#api-token" title="Direct link to heading">â€‹</a></h3><p>terraform cloud soporta 3 tipos de tokens:</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="organization">Organization<a class="hash-link" href="#organization" title="Direct link to heading">â€‹</a></h4><ul><li>Cada organizacion solo puede tener un token valido a la vez</li><li>solo los owners pueden generar y revocar tokens</li><li>los token son creados para configurar y crear workspaces y equipos</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="team">team<a class="hash-link" href="#team" title="Direct link to heading">â€‹</a></h4><ul><li>Cada equipo solo puede tener un token a la vez</li><li>cualquier miembro del equipo puede revocar o generar un token</li><li>Cuando re generamos un token el anterior se vuelve invalido</li><li>DiseÃ±ado para realizar operaciones en el workspaces</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="user">User<a class="hash-link" href="#user" title="Direct link to heading">â€‹</a></h4><ul><li>Hereda los permissions del miembro del equipo</li><li>Puede ser un usuario o una pc</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="estimacion-de-costos">Estimacion de costos<a class="hash-link" href="#estimacion-de-costos" title="Direct link to heading">â€‹</a></h3><p>Terraform tiene un feature para estimar los costos de los recursos que tenemos
en la nube. El problema con esto es la disponibilidad de servicios que tenemos
Azure es el que mas servicios tenemos, le sigue aws y el ultimo es gcp.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="cloud-run-environment">Cloud run environment<a class="hash-link" href="#cloud-run-environment" title="Direct link to heading">â€‹</a></h3><p>Cuando terraform cloud ejecuta un plan o un apply se crea un run environment.
Esto es una virtual machine que usa linux con arquitectura x86_64. Pero no podemos
saber si es ubutun, debia, centos, etc.</p><p>Terraform agregara estas variables con cada ejecucion:</p><ul><li>TFC_RUN_ID el identificador unico del run </li><li>TFC_WORKSPACE_NAME nombre del workspace que se esta ejecutando </li><li>TFC_WORKSPACE_SLUG org/workspace</li><li>TFC_CONFIGURATION_VERSION_GIT_BRANCH nombre de la rama</li><li>TFC_CONFIGURATION_VERSION_GIT_COMMIT_SHA el hash del commit </li><li>TFC_CONFIGURATION_VERSION_GIT_TAG tag de la rama</li></ul><p>Podemos acceder a las variables usando </p><div class="codeBlockContainer_J+bg language-hcl theme-code-block"><div class="codeBlockContent_csEI hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;TFC_RUN_ID&quot; {}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="terraform-cloud-agents">terraform cloud agents<a class="hash-link" href="#terraform-cloud-agents" title="Direct link to heading">â€‹</a></h3><p>Es un feature pagado que nos permite conectar nuestra infraestructura privada u
on-premises. Esto es util cuando tenemos infraestructura que usa vSphere, Nutanix, Openstack</p><ul><li>Estos agentes solo se ejecutan en infraestructura x86_64, con sistema operativo linux</li><li>Podemos ejecutar el agente usando docker </li><li>Soporta terraform desde la version 0.12 en adelante</li><li>Necesitamos 4gb de disco duro como minimo y 2gb de ram </li><li>Necesitamos tener el puerto 443 abierto y registrados los siguientes dominios <ul><li>app.terraform.io</li><li>registry.terraform.io</li><li>releases.hashicorp.com</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="terraform-enterprise">Terraform Enterprise<a class="hash-link" href="#terraform-enterprise" title="Direct link to heading">â€‹</a></h2><p>Es la version de terraform platform pero que nosotros administramos, es decir,
provisionamos un servidor y ejecutamos todo lo relacionado con terraform.</p><p>Ventajas:</p><ul><li>No tenemos limites en los recursos </li><li>audit logging</li><li>SAML</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="requerimientos">Requerimientos<a class="hash-link" href="#requerimientos" title="Direct link to heading">â€‹</a></h3><ol><li>Modo de operacion -&gt; donde almancenaremos la informacion </li></ol><ul><li>Servicios externos <ul><li>Postgres</li><li>S3</li></ul></li><li>Disco duro externos -&gt; almacenamos la informacion en discos duros separados de la maquina</li><li>Demo -&gt; almacenamos la informacion en la misma maquina y luego le hacemos backup</li></ul><ol start="2"><li>Credenciales -&gt; Verifica si tenemos las credenciales pertinentes y los certificados</li></ol><ul><li>Licencia: lo obtenemos de Hashicorp</li><li>Certificado y llave privada: La generamos</li></ul><ol start="3"><li>instancia de linux </li></ol><ul><li>Podemos usarla en:<ul><li>ubuntu </li><li>debian</li><li>centos</li><li>redHat</li><li>oracle linux </li><li>amazon linux</li></ul></li><li>requerimientos de hardware<ul><li>4cpus </li><li>8gb de ram</li><li>10 gb de disco duro el root</li><li>40gb de disco para la docker data</li></ul></li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Podemos tener un entorno <code>air gapped</code>, lo cual significa que nuestra maquina
no tendra acceso a internet por ende no la podran hackear desde internet.
Esto normalmente lo usa el sector publico. terrform enterprise tiene una version
para esto</p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="pricing">Pricing<a class="hash-link" href="#pricing" title="Direct link to heading">â€‹</a></h3><p><img alt="terraform-pricing" src="/docs/assets/images/terraform-pricing-d4345f91cea11a597693900da4c1aae4.png"></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="workspace">Workspace<a class="hash-link" href="#workspace" title="Direct link to heading">â€‹</a></h2></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/herramientas/terraform.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/herramientas/git"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">GIT</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/herramientas/ux"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">UI y UX</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#traditional-it" class="table-of-contents__link toc-highlight">Traditional IT</a><ul><li><a href="#desventajas" class="table-of-contents__link toc-highlight">Desventajas</a></li></ul></li><li><a href="#cloud" class="table-of-contents__link toc-highlight">Cloud</a></li><li><a href="#configuracion-manual" class="table-of-contents__link toc-highlight">Configuracion Manual</a><ul><li><a href="#infraestructura-como-codigo" class="table-of-contents__link toc-highlight">Infraestructura como codigo</a></li><li><a href="#configuration-management" class="table-of-contents__link toc-highlight">Configuration Management</a></li><li><a href="#server-templating" class="table-of-contents__link toc-highlight">Server Templating</a></li><li><a href="#provisioning-tools" class="table-of-contents__link toc-highlight">Provisioning tools</a></li><li><a href="#iac-declarativa" class="table-of-contents__link toc-highlight">IaC Declarativa</a></li><li><a href="#iac-imperativa" class="table-of-contents__link toc-highlight">IaC Imperativa</a></li></ul></li><li><a href="#infrastructure-lifecycle" class="table-of-contents__link toc-highlight">Infrastructure lifecycle</a></li><li><a href="#key-terms" class="table-of-contents__link toc-highlight">Key Terms</a><ul><li><a href="#idempotent" class="table-of-contents__link toc-highlight">Idempotent</a></li><li><a href="#provisioning" class="table-of-contents__link toc-highlight">Provisioning</a></li><li><a href="#deployment" class="table-of-contents__link toc-highlight">Deployment</a></li><li><a href="#orchestration" class="table-of-contents__link toc-highlight">Orchestration</a></li><li><a href="#configuration-drift" class="table-of-contents__link toc-highlight">Configuration Drift</a></li><li><a href="#inmutable-vs-mutable-infraestructure" class="table-of-contents__link toc-highlight">Inmutable vs Mutable infraestructure</a></li><li><a href="#gitops" class="table-of-contents__link toc-highlight">GitOps</a></li><li><a href="#execution-plan" class="table-of-contents__link toc-highlight">Execution plan</a></li></ul></li><li><a href="#terraform-lifecycle" class="table-of-contents__link toc-highlight">Terraform Lifecycle</a></li><li><a href="#cheatsheet" class="table-of-contents__link toc-highlight">CheatSheet</a></li><li><a href="#input-variables" class="table-of-contents__link toc-highlight">input Variables</a><ul><li><a href="#locals" class="table-of-contents__link toc-highlight">Locals</a></li><li><a href="#default-option" class="table-of-contents__link toc-highlight">Default option</a></li><li><a href="#list" class="table-of-contents__link toc-highlight">List</a></li><li><a href="#objects" class="table-of-contents__link toc-highlight">Objects</a></li><li><a href="#types" class="table-of-contents__link toc-highlight">Types</a></li><li><a href="#validations" class="table-of-contents__link toc-highlight">Validations</a></li><li><a href="#environment-variables" class="table-of-contents__link toc-highlight">Environment variables</a></li><li><a href="#sensitive-variables" class="table-of-contents__link toc-highlight">Sensitive variables</a></li><li><a href="#cargar-variables" class="table-of-contents__link toc-highlight">Cargar variables</a></li><li><a href="#jerarquia" class="table-of-contents__link toc-highlight">jerarquia</a></li></ul></li><li><a href="#outputs" class="table-of-contents__link toc-highlight">Outputs</a></li><li><a href="#modulos" class="table-of-contents__link toc-highlight">Modulos</a></li><li><a href="#provisioners" class="table-of-contents__link toc-highlight">Provisioners</a><ul><li><a href="#local-exec" class="table-of-contents__link toc-highlight">Local exec</a></li><li><a href="#remote-exec" class="table-of-contents__link toc-highlight">Remote exec</a></li><li><a href="#conection-block" class="table-of-contents__link toc-highlight">Conection block</a></li><li><a href="#file-provisioner" class="table-of-contents__link toc-highlight">File provisioner</a></li><li><a href="#null-resource" class="table-of-contents__link toc-highlight">Null resource</a></li></ul></li><li><a href="#providers" class="table-of-contents__link toc-highlight">Providers</a><ul><li><a href="#modules" class="table-of-contents__link toc-highlight">Modules</a></li></ul></li><li><a href="#data-sources" class="table-of-contents__link toc-highlight">Data Sources</a></li><li><a href="#resources-meta-arguments" class="table-of-contents__link toc-highlight">Resources Meta Arguments</a><ul><li><a href="#depends-on" class="table-of-contents__link toc-highlight">Depends on</a></li><li><a href="#count" class="table-of-contents__link toc-highlight">count</a></li><li><a href="#for_each" class="table-of-contents__link toc-highlight">for_each</a></li><li><a href="#provider" class="table-of-contents__link toc-highlight">provider</a></li><li><a href="#lifecycle" class="table-of-contents__link toc-highlight">lifecycle</a></li><li><a href="#provisioners-1" class="table-of-contents__link toc-highlight">Provisioners</a></li></ul></li><li><a href="#terraform-expresions" class="table-of-contents__link toc-highlight">terraform expresions</a><ul><li><a href="#types-and-values" class="table-of-contents__link toc-highlight">Types and values</a></li><li><a href="#string-and-templates" class="table-of-contents__link toc-highlight">String and templates</a></li><li><a href="#operators" class="table-of-contents__link toc-highlight">Operators</a></li><li><a href="#conditional-expressions" class="table-of-contents__link toc-highlight">Conditional expressions</a></li><li><a href="#for-expressions" class="table-of-contents__link toc-highlight">For expressions</a></li><li><a href="#splat-expressions" class="table-of-contents__link toc-highlight">Splat expressions</a></li><li><a href="#dynamic-blocks" class="table-of-contents__link toc-highlight">Dynamic blocks</a></li><li><a href="#version-constraints" class="table-of-contents__link toc-highlight">Version constraints</a></li></ul></li><li><a href="#terraform-state" class="table-of-contents__link toc-highlight">Terraform state</a><ul><li><a href="#comandos" class="table-of-contents__link toc-highlight">Comandos</a></li><li><a href="#terraform-state-mv" class="table-of-contents__link toc-highlight">terraform state mv</a></li><li><a href="#terraform-state-backups" class="table-of-contents__link toc-highlight">terraform state backups</a></li></ul></li><li><a href="#debugging-and-troubleshooting" class="table-of-contents__link toc-highlight">debugging and troubleshooting</a><ul><li><a href="#debugging" class="table-of-contents__link toc-highlight">Debugging</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li></ul></li><li><a href="#notas-importantes" class="table-of-contents__link toc-highlight">Notas importantes</a><ul><li><a href="#terraform-init" class="table-of-contents__link toc-highlight">terraform init</a></li><li><a href="#terraform-get" class="table-of-contents__link toc-highlight">Terraform get</a></li><li><a href="#terraform-plan" class="table-of-contents__link toc-highlight">Terraform plan</a></li><li><a href="#terraform-apply" class="table-of-contents__link toc-highlight">Terraform apply</a></li></ul></li><li><a href="#drift" class="table-of-contents__link toc-highlight">Drift</a></li><li><a href="#workflows" class="table-of-contents__link toc-highlight">Workflows</a><ul><li><a href="#individuales" class="table-of-contents__link toc-highlight">Individuales</a></li><li><a href="#equipos" class="table-of-contents__link toc-highlight">Equipos</a></li><li><a href="#equipos-usando-terraform-cloud" class="table-of-contents__link toc-highlight">Equipos usando terraform cloud</a></li></ul></li><li><a href="#backends" class="table-of-contents__link toc-highlight">Backends</a><ul><li><a href="#inicializacion-del-backend" class="table-of-contents__link toc-highlight">Inicializacion del Backend</a></li><li><a href="#terraform_remote_state" class="table-of-contents__link toc-highlight">terraform_remote_state</a></li><li><a href="#bloqueo-del-estado" class="table-of-contents__link toc-highlight">Bloqueo del estado</a></li><li><a href="#proteger-informacion-sensible" class="table-of-contents__link toc-highlight">Proteger informacion sensible</a></li><li><a href="#ignore-files" class="table-of-contents__link toc-highlight">Ignore files</a></li></ul></li><li><a href="#complex-types" class="table-of-contents__link toc-highlight">Complex Types</a><ul><li><a href="#collection-types" class="table-of-contents__link toc-highlight">Collection types</a></li><li><a href="#structural-types" class="table-of-contents__link toc-highlight">Structural types</a></li></ul></li><li><a href="#built-in-functions" class="table-of-contents__link toc-highlight">Built-in Functions</a><ul><li><a href="#numeric" class="table-of-contents__link toc-highlight">Numeric</a></li><li><a href="#string" class="table-of-contents__link toc-highlight">String</a></li><li><a href="#collection" class="table-of-contents__link toc-highlight">Collection</a></li><li><a href="#encoding" class="table-of-contents__link toc-highlight">Encoding</a></li><li><a href="#decoding" class="table-of-contents__link toc-highlight">Decoding</a></li><li><a href="#filesystem" class="table-of-contents__link toc-highlight">Filesystem</a></li><li><a href="#date-and-time" class="table-of-contents__link toc-highlight">Date and time</a></li><li><a href="#hash-and-cripto" class="table-of-contents__link toc-highlight">Hash and Cripto</a></li><li><a href="#ip-network" class="table-of-contents__link toc-highlight">Ip network</a></li><li><a href="#type-conversion" class="table-of-contents__link toc-highlight">Type conversion</a></li></ul></li><li><a href="#terraform-cloud" class="table-of-contents__link toc-highlight">Terraform cloud</a><ul><li><a href="#terminos" class="table-of-contents__link toc-highlight">Terminos</a></li><li><a href="#run-workflows" class="table-of-contents__link toc-highlight">Run workflows</a></li><li><a href="#organizational-level-permissions" class="table-of-contents__link toc-highlight">Organizational Level permissions</a></li><li><a href="#workspace-level-permissions" class="table-of-contents__link toc-highlight">Workspace Level permissions</a></li><li><a href="#api-token" class="table-of-contents__link toc-highlight">Api Token</a></li><li><a href="#estimacion-de-costos" class="table-of-contents__link toc-highlight">Estimacion de costos</a></li><li><a href="#cloud-run-environment" class="table-of-contents__link toc-highlight">Cloud run environment</a></li><li><a href="#terraform-cloud-agents" class="table-of-contents__link toc-highlight">terraform cloud agents</a></li></ul></li><li><a href="#terraform-enterprise" class="table-of-contents__link toc-highlight">Terraform Enterprise</a><ul><li><a href="#requerimientos" class="table-of-contents__link toc-highlight">Requerimientos</a></li><li><a href="#pricing" class="table-of-contents__link toc-highlight">Pricing</a></li></ul></li><li><a href="#workspace" class="table-of-contents__link toc-highlight">Workspace</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.linkedin.com/in/jamil-andres-torres-brunes-0b20631a5/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/jatobrun" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Jatobrun.</div></div></div></footer></div>
<script src="/docs/assets/js/runtime~main.513486dd.js"></script>
<script src="/docs/assets/js/main.a282ba5e.js"></script>
</body>
</html>